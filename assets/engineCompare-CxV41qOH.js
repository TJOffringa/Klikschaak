import{g as q,a as A,b as R,c as U,d as j,i as C,e as N,f as P,h as W,w as O,j as E}from"./index.dev-B2z2tra7.js";const F="http://localhost:5005";function b(c,s){const e=String.fromCharCode(97+s),a=String(8-c);return e+a}function $(c){return c[0]}function B(){const c=q(),s=A(),e=R(),a=U(),g=[];for(let n=0;n<8;n++){let l="",r=0;for(let p=0;p<8;p++){const k=c[n][p].pieces;k.length===0?r++:(r>0&&(l+=r,r=0),k.length===1?l+=$(k[0]):l+="("+k.map($).join("")+")")}r>0&&(l+=r),g.push(l)}const u=s==="white"?"w":"b";let o="";e.white.kingSide&&(o+="K"),e.white.queenSide&&(o+="Q"),e.black.kingSide&&(o+="k"),e.black.queenSide&&(o+="q"),o||(o="-");let i="-";return a&&(i=b(a.row,a.col)),`${g.join("/")} ${u} ${o} ${i} 0 1`}function I(){const c=q(),s=A(),e=R(),a=U(),g=j(),u=s==="white",o=[],i=new Set;for(let n=0;n<8;n++)for(let l=0;l<8;l++){const r=c[n][l].pieces;if(r.length===0||C(r[0])!==u)continue;const p=b(n,l),k=N(c,n,l,r,e,a,g,null);for(const t of k){const v=b(t.row,t.col);let d=p+v;t.type==="klik"?d+="k":t.type?.startsWith("castle-")&&(d+=":"+t.type);const S=u&&t.row===0||!u&&t.row===7,h=r.some(m=>P(m));if(S&&h&&t.type!=="klik"&&!t.type?.startsWith("castle-")){for(const m of["q","r","b","n"]){const w=p+v+m;i.has(w)||(i.add(w),o.push({uci:w,type:t.type||"promotion"}))}continue}i.has(d)||(i.add(d),o.push({uci:d,type:t.type||"normal"}))}if(r.length===2)for(let t=0;t<2;t++){const v=r[t],d=W(c,n,l,v,e,a,g);for(const S of d){const[h,m]=S,w=b(h,m),y=c[h][m];if((y.pieces.length===0||C(y.pieces[0])!==u)&&!O(c,n,l,h,m,r,"unklik",t)){let f=p+w+`u${t}`;if((u&&h===0||!u&&h===7)&&P(v)){for(const T of["q","r","b","n"]){const M=p+w+T+`u${t}`;i.has(M)||(i.add(M),o.push({uci:M,type:"unklik-promotion"}))}continue}i.has(f)||(i.add(f),o.push({uci:f,type:"unklik"}))}if(y.pieces.length>0&&y.pieces.length<2&&C(y.pieces[0])===u&&!y.pieces.some(f=>E(f)==="k")&&E(v)!=="k"&&!O(c,n,l,h,m,r,"unklik-klik",t)){const f=p+w+`U${t}`;i.has(f)||(i.add(f),o.push({uci:f,type:"unklik-klik"}))}}}}return{count:o.length,moves:o}}async function x(c){try{const e=await(await fetch(`${F}/moves`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fen:c}),signal:AbortSignal.timeout(5e3)})).json();return e.error?{count:0,moves:[],error:e.error}:{count:e.count,moves:e.moves.map(a=>({uci:a.uci,type:a.type})),error:null}}catch(s){const e=s instanceof Error?s.message:String(s);return e.includes("fetch")||e.includes("network")||e.includes("Failed")||e.includes("timeout")||e.includes("abort")?{count:0,moves:[],error:"Engine offline"}:{count:0,moves:[],error:e}}}async function K(){const c=B(),s=I(),e=await x(c);if(e.error)return{webappCount:s.count,engineCount:0,webappMoves:s.moves,engineMoves:[],matching:[],webappOnly:s.moves.map(n=>n.uci),engineOnly:[],hasMismatch:!1,engineOnline:!1,error:e.error};const a=new Set(s.moves.map(n=>n.uci)),g=new Set(e.moves.map(n=>n.uci)),u=[],o=[],i=[];for(const n of a)g.has(n)?u.push(n):o.push(n);for(const n of g)a.has(n)||i.push(n);return{webappCount:s.count,engineCount:e.count,webappMoves:s.moves,engineMoves:e.moves,matching:u.sort(),webappOnly:o.sort(),engineOnly:i.sort(),hasMismatch:o.length>0||i.length>0,engineOnline:!0,error:null}}export{B as buildFullFEN,K as comparePositionMoves,I as countAllWebappMoves,x as fetchEngineMoves};
