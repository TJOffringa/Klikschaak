(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const Ke={nl:{title:"Klikschaak",subtitle:"Combineer stukken voor strategische dominantie",newGame:"Nieuw Spel",whiteToMove:"Wit aan zet",blackToMove:"Zwart aan zet",moves:"Zetten",noMoves:"Nog geen zetten",gameRules:"Spelregels",klik:"Klikken:",unklik:"Ontklikken:",kingWarning:"Koning mag NOOIT klikken!",promotionTip:"Promotie: alleen met een pionzet!",autoPromote:"Automatisch promoveren tot dame",selected:"Geselecteerd",possibleMoves:"mogelijke zetten",choosePromotion:"Kies een stuk voor promotie:",chooseCastling:"Kies rokade optie:",onlyRook:"Alleen toren",bothPieces:"Beide stukken",chooseMove:"Kies zet type:",enPassant:"En passant",normalMove:"Normale zet",pawnCaptures:"(pion slaat)",moves_:"beweegt",checkmate:"Schaakmat!",stalemate:"Pat!",check:"SCHAAK!",wins:"wint!",draw:"Remise",gameEndsDraw:"Het spel eindigt in remise"},en:{title:"Clickchess",subtitle:"Combine pieces for strategic dominance",newGame:"New Game",whiteToMove:"White to move",blackToMove:"Black to move",moves:"Moves",noMoves:"No moves yet",gameRules:"Game Rules",klik:"Click:",unklik:"Unclick:",kingWarning:"King may NEVER click!",promotionTip:"Promotion: only with a pawn move!",autoPromote:"Auto-promote to queen",selected:"Selected",possibleMoves:"possible moves",choosePromotion:"Choose a piece for promotion:",chooseCastling:"Choose castling option:",onlyRook:"Only rook",bothPieces:"Both pieces",chooseMove:"Choose move type:",enPassant:"En passant",normalMove:"Normal move",pawnCaptures:"(pawn captures)",moves_:"moves",checkmate:"Checkmate!",stalemate:"Stalemate!",check:"CHECK!",wins:"wins!",draw:"Draw",gameEndsDraw:"The game ends in a draw"}};let H="nl";function Ae(e){H=e,localStorage.setItem("klikschaak-language",e)}function I(){return H}function He(){const e=localStorage.getItem("klikschaak-language");e&&(e==="nl"||e==="en")?H=e:H=navigator.language.slice(0,2)==="nl"?"nl":"en"}function P(e){return Ke[H][e]}function F(e){const t={nl:{K:"Koning",Q:"Dame",R:"Toren",B:"Loper",N:"Paard",P:"Pion",k:"koning",q:"dame",r:"toren",b:"loper",n:"paard",p:"pion"},en:{K:"King",Q:"Queen",R:"Rook",B:"Bishop",N:"Knight",P:"Pawn",k:"king",q:"queen",r:"rook",b:"bishop",n:"knight",p:"pawn"}},n=e.charAt(0);return t[H][n]||e}const N={K:"â™”",Q:"â™•",R:"â™–",B:"â™—",N:"â™˜",P:"â™™",k:"â™š",q:"â™›",r:"â™œ",b:"â™",n:"â™ž",p:"â™Ÿ",P0:"â™™",P1:"â™™",P2:"â™™",P3:"â™™",P4:"â™™",P5:"â™™",P6:"â™™",P7:"â™™",p0:"â™Ÿ",p1:"â™Ÿ",p2:"â™Ÿ",p3:"â™Ÿ",p4:"â™Ÿ",p5:"â™Ÿ",p6:"â™Ÿ",p7:"â™Ÿ"},We={q:5,r:4,b:3,n:2,p:1,k:6},ze=[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]],Ge=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]],Ue=[[-1,-1],[-1,1],[1,-1],[1,1]],_e=[[-1,0],[1,0],[0,-1],[0,1]],Qe="abcdefgh",je="87654321";function b(e){return e===e.toUpperCase()}function O(e){return e.charAt(0).toLowerCase()==="p"}function $(e){return e.charAt(0).toLowerCase()}function me(e){return We[$(e)]||0}function Y(e,t){return Qe[t]+je[e]}function ce(e){return e.map(t=>N[t]).join("")}let k=qe();function qe(){return{board:Ve(),currentTurn:"white",selectedSquare:null,selectedUnklikPiece:null,validMoves:[],moveHistory:[],castlingRights:{white:{kingSide:!0,queenSide:!0},black:{kingSide:!0,queenSide:!0}},enPassantTarget:null,movedPawns:new Set,autoPromoteToQueen:!1,pendingPromotion:null,gameOver:!1}}function Ve(){return Array(8).fill(null).map(()=>Array(8).fill(null).map(()=>({pieces:[]})))}function Ye(){k=qe(),k.board[7][0].pieces=["R"],k.board[7][1].pieces=["N"],k.board[7][2].pieces=["B"],k.board[7][3].pieces=["Q"],k.board[7][4].pieces=["K"],k.board[7][5].pieces=["B"],k.board[7][6].pieces=["N"],k.board[7][7].pieces=["R"];for(let e=0;e<8;e++)k.board[6][e].pieces=[`P${e}`];k.board[0][0].pieces=["r"],k.board[0][1].pieces=["n"],k.board[0][2].pieces=["b"],k.board[0][3].pieces=["q"],k.board[0][4].pieces=["k"],k.board[0][5].pieces=["b"],k.board[0][6].pieces=["n"],k.board[0][7].pieces=["r"];for(let e=0;e<8;e++)k.board[1][e].pieces=[`p${e}`]}function T(){return k.board}function w(){return k.currentTurn}function de(){return k.selectedSquare}function Me(){return k.selectedUnklikPiece}function j(){return k.validMoves}function ve(){return k.moveHistory}function W(){return k.castlingRights}function z(){return k.enPassantTarget}function G(){return k.movedPawns}function be(){return k.autoPromoteToQueen}function $e(){return k.pendingPromotion}function ie(){return k.gameOver}function Z(e){k.selectedSquare=e}function oe(e){k.selectedUnklikPiece=e}function _(e){k.validMoves=e}function ye(e){k.enPassantTarget=e}function Xe(e){k.autoPromoteToQueen=e}function ae(e){k.pendingPromotion=e}function Fe(e){k.gameOver=e}function pe(){k.currentTurn=k.currentTurn==="white"?"black":"white"}function he(e){k.moveHistory.push(e)}function Ze(e){k.movedPawns.add(e)}function U(e,t,n,i,s){n===7&&i===0&&s.includes("R")&&(k.castlingRights.white.queenSide=!1),n===7&&i===7&&s.includes("R")&&(k.castlingRights.white.kingSide=!1),n===0&&i===0&&s.includes("r")&&(k.castlingRights.black.queenSide=!1),n===0&&i===7&&s.includes("r")&&(k.castlingRights.black.kingSide=!1),s.includes("R")&&e===7&&t===0&&(k.castlingRights.white.queenSide=!1),s.includes("R")&&e===7&&t===7&&(k.castlingRights.white.kingSide=!1),s.includes("r")&&e===0&&t===0&&(k.castlingRights.black.queenSide=!1),s.includes("r")&&e===0&&t===7&&(k.castlingRights.black.kingSide=!1)}function le(e){e==="white"?k.castlingRights.white={kingSide:!1,queenSide:!1}:k.castlingRights.black={kingSide:!1,queenSide:!1}}function V(){k.selectedSquare=null,k.selectedUnklikPiece=null,k.validMoves=[]}function x(e,t,n){k.board[e][t].pieces=n}function re(e,t){return k.board[e][t].pieces}function ue(e,t,n,i){for(let s=0;s<8;s++)for(let o=0;o<8;o++){const a=e[s][o].pieces;if(a.length!==0&&b(a[0])!==i){for(const l of a)if(Je(e,s,o,l,t,n))return!0}}return!1}function Je(e,t,n,i,s,o){const a=$(i),l=b(i);if(a==="p"){const c=l?-1:1;return Math.abs(n-o)===1&&t+c===s}if(a==="n"){const c=Math.abs(t-s),r=Math.abs(n-o);return c===2&&r===1||c===1&&r===2}if(a==="k")return Math.abs(t-s)<=1&&Math.abs(n-o)<=1;if((a==="b"||a==="q")&&Math.abs(t-s)===Math.abs(n-o)){const c=s>t?1:-1,r=o>n?1:-1;let h=t+c,g=n+r;for(;h!==s||g!==o;){if(e[h][g].pieces.length>0)return!1;h+=c,g+=r}return!0}if((a==="r"||a==="q")&&(t===s||n===o)){const c=t===s?0:s>t?1:-1,r=n===o?0:o>n?1:-1;let h=t+c,g=n+r;for(;h!==s||g!==o;){if(e[h][g].pieces.length>0)return!1;h+=c,g+=r}return!0}return!1}function J(e,t,n,i,s,o,a){const l=[],c=b(i),r=$(i);if(r==="p"){const h=c?-1:1,g=c?6:1;t+h>=0&&t+h<8&&e[t+h][n].pieces.length===0&&(l.push([t+h,n]),t===g&&!a.has(i)&&e[t+2*h][n].pieces.length===0&&l.push([t+2*h,n]));for(const d of[-1,1]){const u=n+d;if(u>=0&&u<8&&t+h>=0&&t+h<8){const p=e[t+h][u];p.pieces.length>0&&b(p.pieces[0])!==c&&l.push([t+h,u]),o&&o.row===t+h&&o.col===u&&l.push([t+h,u,"en-passant"])}}}if(r==="n")for(const[h,g]of ze){const d=t+h,u=n+g;d>=0&&d<8&&u>=0&&u<8&&l.push([d,u])}if(r==="b"||r==="q")for(const[h,g]of Ue)for(let d=1;d<8;d++){const u=t+h*d,p=n+g*d;if(u<0||u>=8||p<0||p>=8||(l.push([u,p]),e[u][p].pieces.length>0))break}if(r==="r"||r==="q")for(const[h,g]of _e)for(let d=1;d<8;d++){const u=t+h*d,p=n+g*d;if(u<0||u>=8||p<0||p>=8||(l.push([u,p]),e[u][p].pieces.length>0))break}if(r==="k"){for(const[d,u]of Ge){const p=t+d,v=n+u;if(p>=0&&p<8&&v>=0&&v<8){const f=e[p][v];(f.pieces.length===0||b(f.pieces[0])!==c)&&l.push([p,v])}}const h=c?s.white:s.black,g=c?7:0;if(h.kingSide){const d=e[g][7],u=e[g][5];e[g][6].pieces.length===0&&d.pieces.length>0&&d.pieces.some(v=>$(v)==="r")&&(u.pieces.length===0?d.pieces.length===1?l.push([g,6,"castle-k"]):d.pieces.length===2&&l.push([g,6,"castle-k-choice"]):u.pieces.length===1&&b(u.pieces[0])===c&&(d.pieces.length===1?l.push([g,6,"castle-k-klik"]):d.pieces.length===2&&l.push([g,6,"castle-k-unklik-klik"])))}if(h.queenSide){const d=e[g][0],u=e[g][3],p=e[g][2],v=e[g][1];p.pieces.length===0&&v.pieces.length===0&&d.pieces.length>0&&d.pieces.some(f=>$(f)==="r")&&(u.pieces.length===0?d.pieces.length===1?l.push([g,2,"castle-q"]):d.pieces.length===2&&l.push([g,2,"castle-q-choice"]):u.pieces.length===1&&b(u.pieces[0])===c&&(d.pieces.length===1?l.push([g,2,"castle-q-klik"]):d.pieces.length===2&&l.push([g,2,"castle-q-unklik-klik"])))}}return l}function Q(e,t,n,i,s,o,a,l){const c=e.map(d=>d.map(u=>({pieces:[...u.pieces]}))),r=b(o[0]);if(a==="en-passant"){const d=r?i+1:i-1;c[d][s].pieces=[],c[i][s].pieces=[...o],c[t][n].pieces=[]}else if(a==="en-passant-unklik"){const d=r?i+1:i-1;c[d][s].pieces=[];const u=o[l];c[i][s].pieces=[u],c[t][n].pieces=c[t][n].pieces.filter((p,v)=>v!==l)}else if(a==="unklik"||a==="unklik-klik"){const d=o[l];a==="unklik-klik"?c[i][s].pieces=[...c[i][s].pieces,d]:c[i][s].pieces=[d],c[t][n].pieces=c[t][n].pieces.filter((u,p)=>p!==l)}else if(a==="klik")c[i][s].pieces=[...c[i][s].pieces,...o],c[t][n].pieces=[];else if(a?.startsWith("castle-")){const d=a.startsWith("castle-k"),u=d?7:0,p=d?5:3;c[i][s].pieces=o,c[t][n].pieces=[];const v=[...c[t][u].pieces];if(c[t][u].pieces=[],a.includes("unklik-klik")){const S=v.find(q=>$(q)==="r"),m=[...c[t][p].pieces];c[t][p].pieces=[S,...m]}else if(a.includes("klik")&&!a.includes("unklik")){const S=[...c[t][p].pieces];c[t][p].pieces=[...v,...S]}else if(a.includes("both"))c[t][p].pieces=v;else if(v.length===2){const S=v.find(m=>$(m)==="r");c[t][p].pieces=[S]}else c[t][p].pieces=v;const f=d?n+1:n-1;for(const S of[n,f,s])if(ue(c,t,S,r))return!0}else c[i][s].pieces=[...o],c[t][n].pieces=[];let h=-1,g=-1;for(let d=0;d<8;d++){for(let u=0;u<8;u++)if(c[d][u].pieces.includes(r?"K":"k")){h=d,g=u;break}if(h!==-1)break}return h===-1?!1:ue(c,h,g,r)}function R(e,t,n,i,s,o,a,l){const c=new Map,r=b(i[0]),h=i.length===1,g=i.some(u=>O(u));for(const u of i){const p=J(e,t,n,u,s,o,a);for(const v of p){const[f,S,m]=v,q=`${f},${S}`,E=e[f][S],L=O(u),M=r&&f===0||!r&&f===7;if(g&&i.length===2&&!L&&M||g&&(r&&f===7||!r&&f===0))continue;if(m==="en-passant"){const A=c.get(q);A&&A.type!=="en-passant"?c.set(q,{row:f,col:S,type:"en-passant-choice"}):c.set(q,{row:f,col:S,type:"en-passant"});continue}const B=c.get(q);if(B&&B.type==="en-passant"){c.set(q,{row:f,col:S,type:"en-passant-choice"});continue}if(!h)(E.pieces.length===0||b(E.pieces[0])!==r)&&c.set(q,{row:f,col:S,type:m||"normal"});else if(E.pieces.length>0&&b(E.pieces[0])===r){const A=O(u),De=A&&n===S,ke=!E.pieces.some(se=>$(se)==="k")&&!i.some(se=>$(se)==="k");De&&E.pieces.length<2&&ke?c.set(q,{row:f,col:S,type:"klik"}):!A&&E.pieces.length<2&&ke&&c.set(q,{row:f,col:S,type:"klik"})}else(E.pieces.length===0||b(E.pieces[0])!==r)&&c.set(q,{row:f,col:S,type:m||"normal"})}}if(h){const u=i.find(p=>O(p));if(u){const p=r?-1:1,v=r?6:1;if(t+p>=0&&t+p<8){const f=e[t+p][n];if(f.pieces.length===1&&b(f.pieces[0])===r&&!f.pieces.some(S=>$(S)==="k")){const S=`${t+p},${n}`;c.set(S,{row:t+p,col:n,type:"klik"})}}if(t===v&&!a.has(u)&&t+2*p>=0&&t+2*p<8){const f=e[t+2*p][n];if(e[t+p][n].pieces.length===0&&f.pieces.length===1&&b(f.pieces[0])===r&&!f.pieces.some(m=>$(m)==="k")){const m=`${t+2*p},${n}`;c.set(m,{row:t+2*p,col:n,type:"klik"})}}}}let d=Array.from(c.values());return d=d.filter(u=>!Q(e,t,n,u.row,u.col,i,u.type,l)),d}function Re(e,t){const n=t==="white";let i=-1,s=-1;for(let o=0;o<8;o++){for(let a=0;a<8;a++)if(e[o][a].pieces.includes(n?"K":"k")){i=o,s=a;break}if(i!==-1)break}return i===-1?!1:ue(e,i,s,n)}function et(e,t,n,i,s){const o=t==="white";for(let a=0;a<8;a++)for(let l=0;l<8;l++){const c=e[a][l].pieces;if(c.length===0||b(c[0])!==o)continue;if(R(e,a,l,c,n,i,s,null).length>0)return!0;if(c.length===2)for(let h=0;h<2;h++){const g=c[h],d=J(e,a,l,g,n,i,s);for(const u of d){const[p,v]=u,f=e[p][v];if(f.pieces.length===0||b(f.pieces[0])!==o){if(!Q(e,a,l,p,v,c,"unklik",h))return!0}else if(f.pieces.length<2&&b(f.pieces[0])===o&&!f.pieces.some(S=>$(S)==="k")&&!Q(e,a,l,p,v,c,"unklik-klik",h))return!0}}}return!1}window.handleSquareClick=ee;window.handleUnklikSelect=lt;window.initializeBoard=fe;window.toggleAutoPromote=rt;window.executePromotion=Ne;window.executeCastling=te;window.movePiece=ne;window.switchLanguage=tt;function tt(){const e=I()==="nl"?"en":"nl";Ae(e),D(),K(),nt()}function nt(){const e=document.querySelector(".header h1");e&&(e.textContent=`ðŸ‘‘ ${P("title")}`);const t=document.querySelector(".header p");t&&(t.textContent=P("subtitle"));const n=document.querySelector(".new-game-btn");n&&(n.textContent=`ðŸ”„ ${P("newGame")}`);const i=document.querySelector(".panel h2");if(i){const r=document.getElementById("moveCount")?.textContent||"0";i.innerHTML=`ðŸ“‹ ${P("moves")} (<span id="moveCount">${r}</span>)`}const s=document.querySelector(".rules h2");s&&(s.textContent=`âš¡ ${P("gameRules")}`);const o=document.querySelectorAll(".rules p");o.length>=4&&(o[0].innerHTML=`<strong style="color: #c084fc;">${P("klik")}</strong> ${I()==="nl"?"Selecteer stuk, klik op veld met blauwe ring":"Select piece, click square with blue ring"}`,o[1].innerHTML=`<strong style="color: #60a5fa;">${P("unklik")}</strong> ${I()==="nl"?"Klik op driehoek met het stuk":"Click triangle with the piece"}`,o[2].innerHTML=`âš ï¸ ${P("kingWarning")}`,o[3].innerHTML=`ðŸ’¡ ${P("promotionTip")}`);const a=document.querySelector('label[for="autoPromote"]');a&&(a.textContent=P("autoPromote"));const l=document.querySelector("#selectedInfo h2");l&&(l.textContent=P("selected"));const c=document.getElementById("langBtn");c&&(c.textContent=I()==="nl"?"EN":"NL")}function it(e,t,n,i){if(e.length===0)return"";const s=v=>b(v)?"piece piece-white":"piece piece-black";if(e.length===1)return`<div class="${s(e[0])}">${N[e[0]]}</div>`;const o=[...e].sort((v,f)=>me(f)-me(v)),a=o[0],l=o[1],c=b(e[0]),r=Me(),h=i&&r!==null&&e.indexOf(a)===r,g=i&&r!==null&&e.indexOf(l)===r,d=i&&r===null,u=w(),p=c&&u==="white"||!c&&u==="black";return`<div class="stacked-piece">
    <svg class="stacked-svg" viewBox="0 0 64 64">
      <line x1="32" y1="0" x2="0" y2="64" stroke="rgba(100,100,100,0.4)" stroke-width="2"/>
      <line x1="32" y1="0" x2="64" y2="64" stroke="rgba(100,100,100,0.4)" stroke-width="2"/>
    </svg>
    ${d?'<div class="whole-selected"></div>':""}
    <div class="stacked-center">
      <div class="stacked-top ${s(l)}">${N[l]}</div>
      <div class="stacked-bottom ${s(a)}">${N[a]}</div>
    </div>
    ${p?`
      <div class="triangle-left ${h?"selected":""}" onclick="handleUnklikSelect(${t},${n},${e.indexOf(a)},event)" title="${I()==="nl"?"Zet met":"Move with"} ${F(a)}">
        <span class="triangle-symbol left ${s(a)}">${N[a]}</span>
      </div>
      <div class="triangle-right ${g?"selected":""}" onclick="handleUnklikSelect(${t},${n},${e.indexOf(l)},event)" title="${I()==="nl"?"Zet met":"Move with"} ${F(l)}">
        <span class="triangle-symbol right ${s(l)}">${N[l]}</span>
      </div>
    `:""}
    ${!h&&!d?'<div class="triangle-bg-left"></div>':""}
    ${!g&&!d?'<div class="triangle-bg-right"></div>':""}
  </div>`}function D(){const e=document.getElementById("board");if(!e)return;const t=T(),n=de(),i=j();e.innerHTML="";for(let s=0;s<8;s++){const o=document.createElement("div");o.className="board-row";for(let a=0;a<8;a++){const l=document.createElement("div"),c=(s+a)%2===0;l.className=`square ${c?"light":"dark"}`,l.dataset.row=String(s),l.dataset.col=String(a),n&&n[0]===s&&n[1]===a&&l.classList.add("selected");const r=t[s][a].pieces,h=n&&n[0]===s&&n[1]===a;l.innerHTML=it(r,s,a,!!h);const g=i.find(d=>d.row===s&&d.col===a);if(g){const d=document.createElement("div");g.type==="klik"?d.className="valid-klik":g.type==="unklik-klik"?d.className="valid-unklik-klik":r.length>0?d.className="valid-capture":d.className="valid-move",l.appendChild(d)}l.onclick=d=>{const u=d.target;!u.classList.contains("triangle-left")&&!u.classList.contains("triangle-right")&&ee(s,a)},o.appendChild(l)}e.appendChild(o)}}function K(){const e=document.getElementById("turnIndicator");e&&(e.textContent=w()==="white"?P("whiteToMove"):P("blackToMove"),e.className=`turn-indicator ${w()==="white"?"turn-white":"turn-black"}`);const t=document.getElementById("moveCount");t&&(t.textContent=String(Math.ceil(ve().length/2)));const n=document.getElementById("moveHistory"),i=ve();if(n)if(i.length===0)n.innerHTML=`<p style="color:#94a3b8;text-align:center;padding:16px 0;">${P("noMoves")}</p>`;else{const s=[];for(let o=0;o<i.length;o+=2){const a=i[o],l=o+1<i.length?i[o+1]:null;s.push({moveNumber:Math.floor(o/2)+1,white:a,black:l})}n.innerHTML=s.slice(-10).reverse().map(o=>{const a=o.white?o.white.notation:"",l=o.black?o.black.notation:"";return`<div class="move-pair">
          <span class="move-number">${o.moveNumber}.</span>
          <span class="move-white">${a}</span>
          <span class="move-black">${l}</span>
        </div>`}).join("")}st()}function st(){const e=document.getElementById("selectedInfo");if(!e)return;const t=de();if(t&&T()[t[0]][t[1]].pieces.length>0){e.classList.add("show");const n=T()[t[0]][t[1]].pieces,i=l=>b(l)?"selected-piece-icon piece piece-white":"selected-piece-icon piece piece-black",s=document.getElementById("selectedPieces");s&&(s.innerHTML=n.map(l=>`<div class="${i(l)}">${N[l]}</div>`).join(""));const o=document.getElementById("selectedNames");o&&(o.textContent=n.map(l=>F(l)).join(" + "));const a=document.getElementById("selectedMoves");a&&(a.textContent=`${j().length} ${P("possibleMoves")}`)}else e.classList.remove("show")}function ct(){const e=document.getElementById("checkIndicator");e&&e.remove();const t=document.createElement("div");t.id="checkIndicator",t.className="check-indicator",t.textContent=P("check");const n=document.querySelector(".board-container");n&&(n.style.position="relative",n.appendChild(t)),setTimeout(()=>{const i=document.getElementById("checkIndicator");i&&i.remove()},3e3)}function Se(e,t){const n=document.createElement("div");n.className="promotion-overlay",n.id="gameOverOverlay";const i=document.createElement("div");i.className="game-over-box";const s=document.createElement("div");s.className="game-over-title",s.textContent=P(e==="checkmate"?"checkmate":"stalemate"),i.appendChild(s);const o=document.createElement("div");if(o.className="game-over-message",e==="stalemate")o.textContent=P("gameEndsDraw");else{const l=t==="white"?I()==="nl"?"Wit":"White":I()==="nl"?"Zwart":"Black";o.textContent=`${l} ${P("wins")}`}i.appendChild(o);const a=document.createElement("button");a.className="game-over-btn",a.textContent=P("newGame"),a.onclick=()=>fe(),i.appendChild(a),n.appendChild(i),document.body.appendChild(n)}function Pe(){const e=$e();if(!e)return;const t=document.createElement("div");t.className="promotion-overlay",t.id="promotionOverlay";const n=e.isWhite,i=n?["Q","R","B","N"]:["q","r","b","n"],s=document.createElement("div");s.className="promotion-box";const o=document.createElement("div");o.className="promotion-title",o.textContent=P("choosePromotion"),s.appendChild(o);const a=document.createElement("div");a.className="promotion-pieces",i.forEach(l=>{const c=document.createElement("div");c.className="promotion-choice";const r=document.createElement("div");r.className=`promotion-piece piece ${n?"piece-white":"piece-black"}`,r.textContent=N[l],c.appendChild(r),c.onclick=()=>Ne(l),a.appendChild(c)}),s.appendChild(a),t.appendChild(s),document.body.appendChild(t)}function ot(e,t,n,i,s){const o=document.createElement("div");o.className="promotion-overlay",o.id="castlingChoiceOverlay";const l=s.includes("k")?7:0,r=T()[e][l].pieces,h=r.find(B=>$(B)==="r"),g=r.find(B=>$(B)!=="r"),d=b(h),u=document.createElement("div");u.className="promotion-box";const p=document.createElement("div");p.className="promotion-title",p.textContent=P("chooseCastling"),u.appendChild(p);const v=document.createElement("div");v.className="promotion-pieces",v.style.gap="20px";const f=document.createElement("div");f.className="promotion-choice",f.style.cssText="width:120px;height:100px;flex-direction:column;display:flex;justify-content:center;align-items:center;";const S=document.createElement("div");S.className=`promotion-piece piece ${d?"piece-white":"piece-black"}`,S.textContent=N[h],S.style.fontSize="48px",f.appendChild(S);const m=document.createElement("div");m.textContent=P("onlyRook"),m.style.cssText="font-size:12px;margin-top:5px;color:white;",f.appendChild(m),f.onclick=()=>{document.getElementById("castlingChoiceOverlay")?.remove(),te(e,t,n,i,s.replace("-choice",""))},v.appendChild(f);const q=document.createElement("div");q.className="promotion-choice",q.style.cssText="width:120px;height:100px;flex-direction:column;display:flex;justify-content:center;align-items:center;";const E=document.createElement("div");E.style.cssText="display:flex;gap:5px;";const L=document.createElement("div");L.className=`piece ${d?"piece-white":"piece-black"}`,L.textContent=N[h],L.style.fontSize="36px";const M=document.createElement("div");M.className=`piece ${d?"piece-white":"piece-black"}`,M.textContent=N[g],M.style.fontSize="36px",E.appendChild(L),E.appendChild(M),q.appendChild(E);const C=document.createElement("div");C.textContent=P("bothPieces"),C.style.cssText="font-size:12px;margin-top:5px;color:white;",q.appendChild(C),q.onclick=()=>{document.getElementById("castlingChoiceOverlay")?.remove(),te(e,t,n,i,s.replace("-choice","-both"))},v.appendChild(q),u.appendChild(v),o.appendChild(u),document.body.appendChild(o)}function at(e,t,n,i){const s=document.createElement("div");s.className="promotion-overlay",s.id="enPassantChoiceOverlay";const a=T()[e][t].pieces,l=b(a[0]),c=a.find(C=>$(C)==="p"),r=a.find(C=>$(C)!=="p"),h=document.createElement("div");h.className="promotion-box";const g=document.createElement("div");g.className="promotion-title",g.textContent=P("chooseMove"),h.appendChild(g);const d=document.createElement("div");d.className="promotion-pieces",d.style.gap="20px";const u=document.createElement("div");u.className="promotion-choice",u.style.cssText="width:140px;height:110px;flex-direction:column;display:flex;justify-content:center;align-items:center;";const p=document.createElement("div");p.style.cssText="display:flex;gap:5px;";const v=document.createElement("div");v.className=`piece ${l?"piece-white":"piece-black"}`,v.textContent=N[c],v.style.fontSize="48px",p.appendChild(v),u.appendChild(p);const f=document.createElement("div");f.textContent=P("enPassant"),f.style.cssText="font-size:12px;margin-top:5px;color:white;",u.appendChild(f);const S=document.createElement("div");S.textContent=P("pawnCaptures"),S.style.cssText="font-size:10px;color:#64748b;",u.appendChild(S),u.onclick=()=>{document.getElementById("enPassantChoiceOverlay")?.remove(),ne(e,t,n,i,"en-passant")},d.appendChild(u);const m=document.createElement("div");m.className="promotion-choice",m.style.cssText="width:140px;height:110px;flex-direction:column;display:flex;justify-content:center;align-items:center;";const q=document.createElement("div");q.style.cssText="display:flex;gap:5px;";const E=document.createElement("div");E.className=`piece ${l?"piece-white":"piece-black"}`,E.textContent=N[r],E.style.fontSize="48px",q.appendChild(E),m.appendChild(q);const L=document.createElement("div");L.textContent=P("normalMove"),L.style.cssText="font-size:12px;margin-top:5px;color:white;",m.appendChild(L);const M=document.createElement("div");M.textContent=`(${F(r)} ${P("moves_")})`,M.style.cssText="font-size:10px;color:#64748b;",m.appendChild(M),m.onclick=()=>{document.getElementById("enPassantChoiceOverlay")?.remove(),ne(e,t,n,i,"normal")},d.appendChild(m),h.appendChild(d),s.appendChild(h),document.body.appendChild(s)}function ee(e,t){if(ie())return;const n=T(),i=n[e][t],s=de();if(s){const[o,a]=s,c=j().find(r=>r.row===e&&r.col===t);if(c){const r=c.type;r==="castle-k"||r==="castle-q"||r==="castle-k-klik"||r==="castle-q-klik"||r==="castle-k-unklik-klik"||r==="castle-q-unklik-klik"?te(o,a,e,t,r):r==="castle-k-choice"||r==="castle-q-choice"?ot(o,a,e,t,r):r==="en-passant-choice"?at(o,a,e,t):ne(o,a,e,t,r)}else if(i.pieces.length>0&&b(i.pieces[0])===(w()==="white")){Z([e,t]),oe(null);const r=R(n,e,t,i.pieces,W(),z(),G(),null);_(r)}else V()}else if(i.pieces.length>0){const o=b(i.pieces[0]);if(o&&w()==="white"||!o&&w()==="black"){Z([e,t]),oe(null);const a=R(n,e,t,i.pieces,W(),z(),G(),null);_(a)}}D(),K()}function lt(e,t,n,i){if(ie())return;i.stopPropagation();const s=T(),o=s[e][t],a=o.pieces[n],l=b(a);if(l&&w()!=="white"||!l&&w()!=="black")return;if(Z([e,t]),oe(n),$(a)==="k"){const u=J(s,e,t,a,W(),z(),G()).map(p=>({row:p[0],col:p[1],type:"unklik"})).filter(p=>!Q(s,e,t,p.row,p.col,o.pieces,"unklik",n));_(u),D(),K();return}const c=J(s,e,t,a,W(),z(),G()),r=[],h=O(a);for(const d of c){const[u,p,v]=d,f=s[u][p];h&&(l&&u===7||!l&&u===0)||(v==="en-passant"?r.push({row:u,col:p,type:"en-passant-unklik"}):f.pieces.length===0||b(f.pieces[0])!==l?r.push({row:u,col:p,type:"unklik"}):f.pieces.length<2&&b(f.pieces[0])===l&&!f.pieces.some(m=>$(m)==="k")&&r.push({row:u,col:p,type:"unklik-klik"}))}const g=r.filter(d=>!Q(s,e,t,d.row,d.col,o.pieces,d.type,n));_(g),D(),K()}function te(e,t,n,i,s){const o=T(),a=s.startsWith("castle-k"),l=a?7:0,c=a?5:3,r=o[e][t].pieces;x(n,i,r),x(e,t,[]);const h=[...o[e][l].pieces];x(e,l,[]);let g=`O-O${a?"":"-O"}`;if(s.includes("unklik-klik")){const u=h.find(f=>$(f)==="r"),p=h.find(f=>$(f)!=="r"),v=[...o[e][c].pieces];x(e,c,[u,...v]),x(e,l,[p]),g+=" (toren klikt)"}else if(s.includes("klik")&&!s.includes("unklik")){const u=[...o[e][c].pieces];x(e,c,[...h,...u]),g+=" klikt"}else if(s.includes("both"))x(e,c,h),g+=" (beide)";else if(h.length===2){const u=h.find(v=>$(v)==="r"),p=h.find(v=>$(v)!=="r");x(e,c,[u]),x(e,l,[p]),g+=" (alleen toren)"}else x(e,c,h);le(w()),V();const d=w();pe(),he({turn:d,notation:g}),D(),K(),ge()}function ne(e,t,n,i,s){const o=T(),a=o[e][t],l=o[n][i];let c,r="";ye(null);const h=l.pieces.length>0,g=Y(e,t),d=Y(n,i),u=Me();if(s==="unklik"||s==="unklik-klik"||s==="en-passant-unklik"){const m=a.pieces[u],q=a.pieces.filter((M,C)=>C!==u);if(c=[m],x(e,t,q),r=`${N[m]}${g}-${d}`,s==="en-passant-unklik"){const M=w()==="white"?n+1:n-1;x(M,i,[]),x(n,i,[m]),r+=` x${Y(M,i)} e.p.`,U(e,t,n,i,c),X(r);return}const E=O(m),L=b(m)&&n===0||!b(m)&&n===7;if(E&&L){if(s==="unklik-klik"?(x(n,i,[...l.pieces,m]),r+=" klikt"):l.pieces.length>0?(x(n,i,[m]),r+=" x"):x(n,i,[m]),be()){const M=b(m)?"Q":"q",B=re(n,i).filter(A=>!O(A));B.unshift(M),x(n,i,B),r+="="+N[M],U(e,t,n,i,B),X(r)}else{const M={row:n,col:i,isWhite:b(m),moveNotation:r,wasCapture:l.pieces.length>1||s!=="unklik-klik"&&l.pieces.length>0};ae(M),Pe()}return}s==="unklik-klik"?(x(n,i,[...l.pieces,m]),r+=" klikt"):(l.pieces.length>0&&(r=`${N[m]}${g}x${d}`),x(n,i,[m])),U(e,t,n,i,c)}else if(s==="en-passant"){c=[...a.pieces],x(e,t,[]);const m=w()==="white"?n+1:n-1;x(m,i,[]),x(n,i,c),r=`${ce(c)}${g}x${Y(m,i)} e.p.`}else{c=[...a.pieces],x(e,t,[]),r=`${ce(c)}${g}-${d}`;const m=c.some(E=>O(E)),q=b(c[0])&&n===0||!b(c[0])&&n===7;if(m&&q){if(s==="klik"?(x(n,i,[...l.pieces,...c]),r+=" klikt"):(l.pieces.length>0&&(r+=" x"),x(n,i,c)),be()){const E=b(c[0])?"Q":"q",M=re(n,i).filter(C=>!O(C));M.unshift(E),x(n,i,M),r+="="+N[E],U(e,t,n,i,M),X(r)}else{const E={row:n,col:i,isWhite:b(c[0]),moveNotation:r,otherPieces:c.filter(L=>!O(L)),wasCapture:l.pieces.length>c.length};ae(E),Pe()}return}s==="klik"?(x(n,i,[...l.pieces,...c]),r+=" klikt"):(l.pieces.length>0&&(r=`${ce(c)}${g}x${d}`),x(n,i,c)),U(e,t,n,i,c)}const p=c.some(m=>O(m)),v=t===i,f=b(c[0])&&e===6||!b(c[0])&&e===1;if(p&&v&&f&&!h&&Math.abs(e-n)===2){const m=(e+n)/2;ye({row:m,col:i})}c.includes("K")?le("white"):c.includes("k")&&le("black");for(const m of c)O(m)&&Ze(m);X(r)}function X(e){V();const t=w();pe(),he({turn:t,notation:e}),D(),K(),ge()}function Ne(e){const t=$e();if(!t)return;const{row:n,col:i,moveNotation:s}=t,a=re(n,i).filter(h=>!O(h));a.unshift(e),x(n,i,a);const l=document.getElementById("promotionOverlay");l&&l.remove();const c=s+"="+N[e];V();const r=w();pe(),he({turn:r,notation:c}),ae(null),D(),K(),ge()}function ge(){const e=T(),t=w(),n=Re(e,t);et(e,t,W(),z(),G())?n&&ct():(Fe(!0),n?Se("checkmate",t==="white"?"black":"white"):Se("stalemate",null))}function fe(){Ye(),D(),K()}function rt(){const e=document.getElementById("autoPromote");Xe(e.checked)}const y={dragging:!1,from:null,pieces:[],ghostElement:null,startX:0,startY:0,hasMoved:!1},xe=10;function ut(){const e=document.getElementById("board");e&&(e.addEventListener("mousedown",ft),e.addEventListener("touchstart",vt,{passive:!1}),document.addEventListener("mousemove",kt),document.addEventListener("mouseup",mt),document.addEventListener("touchmove",bt,{passive:!1}),document.addEventListener("touchend",Ee),document.addEventListener("touchcancel",Ee))}function we(e){const n=e.target.closest(".square");if(!n)return null;const i=parseInt(n.dataset.row||"-1"),s=parseInt(n.dataset.col||"-1");return i<0||s<0?null:{element:n,pos:{row:i,col:s}}}function Le(e,t){const n=document.elementsFromPoint(e,t);for(const i of n)if(i.classList.contains("square")){const s=i,o=parseInt(s.dataset.row||"-1"),a=parseInt(s.dataset.col||"-1");if(o>=0&&a>=0)return{element:s,pos:{row:o,col:a}}}return null}function dt(e){const t=document.createElement("div");return t.className="drag-ghost",t.innerHTML=e.map(n=>`<span class="piece ${b(n)?"piece-white":"piece-black"}">${N[n]}</span>`).join(""),document.body.appendChild(t),t}function Ce(e,t,n){e.style.left=`${t}px`,e.style.top=`${n}px`}function pt(e){const t=T();document.querySelectorAll(".square").forEach(n=>{const i=n,s=parseInt(i.dataset.row||"-1"),o=parseInt(i.dataset.col||"-1"),a=e.find(l=>l.row===s&&l.col===o);a&&(i.classList.add("drag-valid-target"),t[s][o].pieces.length>0&&(a.type==="klik"||a.type==="unklik-klik"?i.classList.add("drag-klik-target"):i.classList.add("drag-capture-target")))})}function ht(){document.querySelectorAll(".square").forEach(e=>{e.classList.remove("drag-valid-target","drag-capture-target","drag-klik-target","drag-over","dragging")})}function Oe(e,t){return t.find(n=>n.row===e.row&&n.col===e.col)}function Te(e,t,n){const s=T()[e.row][e.col].pieces;if(s.length===0)return!1;const o=b(s[0]),a=w();return o&&a!=="white"||!o&&a!=="black"?!1:(y.from=e,y.pieces=s,y.startX=t,y.startY=n,y.hasMoved=!1,y.dragging=!1,!0)}function gt(e,t){if(!y.from)return;y.dragging=!0,y.ghostElement=dt(y.pieces),Ce(y.ghostElement,e,t);const n=document.querySelector(`.square[data-row="${y.from.row}"][data-col="${y.from.col}"]`);n&&n.classList.add("dragging");const i=R(T(),y.from.row,y.from.col,y.pieces,W(),z(),G(),null);_(i),pt(i)}function Be(e,t){if(!y.from)return;if(!y.dragging){const i=Math.abs(e-y.startX),s=Math.abs(t-y.startY);(i>xe||s>xe)&&(y.hasMoved=!0,gt(e,t));return}y.ghostElement&&Ce(y.ghostElement,e,t),document.querySelectorAll(".square.drag-over").forEach(i=>{i.classList.remove("drag-over")});const n=Le(e,t);if(n){const i=j();Oe(n.pos,i)&&n.element.classList.add("drag-over")}}function Ie(e,t){const n=y.from,i=y.dragging,s=y.hasMoved;if(y.ghostElement&&(y.ghostElement.remove(),y.ghostElement=null),ht(),y.from=null,y.pieces=[],y.dragging=!1,y.hasMoved=!1,!!n){if(!s){ee(n.row,n.col);return}if(i){const o=Le(e,t);if(o){const a=j();if(Oe(o.pos,a)){Z([n.row,n.col]),ee(o.pos.row,o.pos.col);return}}V()}}}function ft(e){if(e.button!==0||ie())return;const t=e.target;if(t.classList.contains("triangle-left")||t.classList.contains("triangle-right"))return;const n=we(e);n&&Te(n.pos,e.clientX,e.clientY)&&e.preventDefault()}function kt(e){y.from&&Be(e.clientX,e.clientY)}function mt(e){y.from&&Ie(e.clientX,e.clientY)}function vt(e){if(ie()||e.touches.length!==1)return;const t=e.target;if(t.classList.contains("triangle-left")||t.classList.contains("triangle-right"))return;const n=e.touches[0],i=we(n);i&&Te(i.pos,n.clientX,n.clientY)}function bt(e){if(!y.from||e.touches.length!==1)return;e.preventDefault();const t=e.touches[0];Be(t.clientX,t.clientY)}function Ee(e){if(!y.from)return;const t=e.changedTouches[0];Ie(t.clientX,t.clientY)}He();document.addEventListener("DOMContentLoaded",()=>{fe(),ut()});
