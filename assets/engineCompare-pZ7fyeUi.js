import{g as $,a as A,b as j,c as q,d as N,i as C,e as _,f as P,h as F,w as T,j as E}from"./index.dev-TupSt3v_.js";const R="http://localhost:5005";function k(r,s){const e=String.fromCharCode(97+s),n=String(8-r);return e+n}function O(r){return r[0]}function W(){const r=$(),s=A(),e=j(),n=q(),h=[];for(let t=0;t<8;t++){let p="",a=0;for(let u=0;u<8;u++){const y=r[t][u].pieces;y.length===0?a++:(a>0&&(p+=a,a=0),y.length===1?p+=O(y[0]):p+="("+y.map(O).join("")+")")}a>0&&(p+=a),h.push(p)}const l=s==="white"?"w":"b";let i="";e.white.kingSide&&(i+="K"),e.white.queenSide&&(i+="Q"),e.black.kingSide&&(i+="k"),e.black.queenSide&&(i+="q"),i||(i="-");let c="-";return n&&(c=k(n.row,n.col)),`${h.join("/")} ${l} ${i} ${c} 0 1`}function B(){const r=$(),s=A(),e=j(),n=q(),h=N(),l=s==="white",i=[],c=new Set;for(let t=0;t<8;t++)for(let p=0;p<8;p++){const a=r[t][p].pieces;if(a.length===0||C(a[0])!==l)continue;const u=k(t,p),y=_(r,t,p,a,e,n,h,null);for(const o of y){const w=k(o.row,o.col);let d=u+w;o.type==="klik"?d+="k":o.type?.startsWith("castle-")&&(d+=":"+o.type);const S=l&&o.row===0||!l&&o.row===7,g=a.some(m=>P(m));if(S&&g&&o.type!=="klik"&&!o.type?.startsWith("castle-")){for(const m of["q","r","b","n"]){const v=u+w+m;c.has(v)||(c.add(v),i.push({uci:v,type:o.type||"promotion"}))}continue}c.has(d)||(c.add(d),i.push({uci:d,type:o.type||"normal"}))}if(a.length===2)for(let o=0;o<2;o++){const w=a[o],d=F(r,t,p,w,e,n,h);for(const S of d){const[g,m]=S,v=k(g,m),b=r[g][m];if((b.pieces.length===0||C(b.pieces[0])!==l)&&!T(r,t,p,g,m,a,"unklik",o)){let f=u+v+`u${o}`;if((l&&g===0||!l&&g===7)&&P(w)){for(const U of["q","r","b","n"]){const M=u+v+U+`u${o}`;c.has(M)||(c.add(M),i.push({uci:M,type:"unklik-promotion"}))}continue}c.has(f)||(c.add(f),i.push({uci:f,type:"unklik"}))}if(b.pieces.length>0&&b.pieces.length<2&&C(b.pieces[0])===l&&!b.pieces.some(f=>E(f)==="k")&&E(w)!=="k"&&!T(r,t,p,g,m,a,"unklik-klik",o)){const f=u+v+`U${o}`;c.has(f)||(c.add(f),i.push({uci:f,type:"unklik-klik"}))}}}}return{count:i.length,moves:i}}async function I(r){try{const e=await(await fetch(`${R}/moves`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fen:r}),signal:AbortSignal.timeout(5e3)})).json();return e.error?{count:0,moves:[],error:e.error}:{count:e.count,moves:e.moves.map(n=>({uci:n.uci,type:n.type})),error:null}}catch(s){const e=s instanceof Error?s.message:String(s);return e.includes("fetch")||e.includes("network")||e.includes("Failed")||e.includes("timeout")||e.includes("abort")?{count:0,moves:[],error:"Engine offline"}:{count:0,moves:[],error:e}}}async function G(r,s=4){try{const n=await(await fetch(`${R}/eval`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fen:r,depth:s}),signal:AbortSignal.timeout(15e3)})).json();return n.error?{score:0,scoreType:"cp",bestMove:null,pv:[],depth:0,nodes:0,nps:0,time_ms:0,error:n.error}:{score:n.score,scoreType:n.scoreType,bestMove:n.bestMove,pv:n.pv,depth:n.depth,nodes:n.nodes,nps:n.nps,time_ms:n.time_ms,error:null}}catch(e){const n=e instanceof Error?e.message:String(e);return n.includes("fetch")||n.includes("network")||n.includes("Failed")||n.includes("timeout")||n.includes("abort")?{score:0,scoreType:"cp",bestMove:null,pv:[],depth:0,nodes:0,nps:0,time_ms:0,error:"Engine offline"}:{score:0,scoreType:"cp",bestMove:null,pv:[],depth:0,nodes:0,nps:0,time_ms:0,error:n}}}async function K(){const r=W(),s=B(),e=await I(r);if(e.error)return{webappCount:s.count,engineCount:0,webappMoves:s.moves,engineMoves:[],matching:[],webappOnly:s.moves.map(t=>t.uci),engineOnly:[],hasMismatch:!1,engineOnline:!1,error:e.error};const n=new Set(s.moves.map(t=>t.uci)),h=new Set(e.moves.map(t=>t.uci)),l=[],i=[],c=[];for(const t of n)h.has(t)?l.push(t):i.push(t);for(const t of h)n.has(t)||c.push(t);return{webappCount:s.count,engineCount:e.count,webappMoves:s.moves,engineMoves:e.moves,matching:l.sort(),webappOnly:i.sort(),engineOnly:c.sort(),hasMismatch:i.length>0||c.length>0,engineOnline:!0,error:null}}export{W as buildFullFEN,K as comparePositionMoves,B as countAllWebappMoves,G as fetchEngineEval,I as fetchEngineMoves};
