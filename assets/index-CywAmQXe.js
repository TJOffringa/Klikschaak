(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(i){if(i.ep)return;i.ep=!0;const c=n(i);fetch(i.href,c)}})();(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const Ne={nl:{title:"Klikschaak",subtitle:"Combineer stukken voor strategische dominantie",newGame:"Nieuw Spel",whiteToMove:"Wit aan zet",blackToMove:"Zwart aan zet",moves:"Zetten",noMoves:"Nog geen zetten",gameRules:"Spelregels",klik:"Klikken:",unklik:"Ontklikken:",kingWarning:"Koning mag NOOIT klikken!",promotionTip:"Promotie: alleen met een pionzet!",autoPromote:"Automatisch promoveren tot dame",selected:"Geselecteerd",possibleMoves:"mogelijke zetten",choosePromotion:"Kies een stuk voor promotie:",chooseCastling:"Kies rokade optie:",onlyRook:"Alleen toren",bothPieces:"Beide stukken",chooseMove:"Kies zet type:",enPassant:"En passant",normalMove:"Normale zet",pawnCaptures:"(pion slaat)",moves_:"beweegt",checkmate:"Schaakmat!",stalemate:"Pat!",check:"SCHAAK!",wins:"wint!",draw:"Remise",gameEndsDraw:"Het spel eindigt in remise"},en:{title:"Clickchess",subtitle:"Combine pieces for strategic dominance",newGame:"New Game",whiteToMove:"White to move",blackToMove:"Black to move",moves:"Moves",noMoves:"No moves yet",gameRules:"Game Rules",klik:"Click:",unklik:"Unclick:",kingWarning:"King may NEVER click!",promotionTip:"Promotion: only with a pawn move!",autoPromote:"Auto-promote to queen",selected:"Selected",possibleMoves:"possible moves",choosePromotion:"Choose a piece for promotion:",chooseCastling:"Choose castling option:",onlyRook:"Only rook",bothPieces:"Both pieces",chooseMove:"Choose move type:",enPassant:"En passant",normalMove:"Normal move",pawnCaptures:"(pawn captures)",moves_:"moves",checkmate:"Checkmate!",stalemate:"Stalemate!",check:"CHECK!",wins:"wins!",draw:"Draw",gameEndsDraw:"The game ends in a draw"}};let L="nl";function Pe(e){L=e,localStorage.setItem("klikschaak-language",e)}function O(){return L}function qe(){const e=localStorage.getItem("klikschaak-language");e&&(e==="nl"||e==="en")?L=e:L=navigator.language.slice(0,2)==="nl"?"nl":"en"}function x(e){return Ne[L][e]}function G(e){const t={nl:{K:"Koning",Q:"Dame",R:"Toren",B:"Loper",N:"Paard",P:"Pion",k:"koning",q:"dame",r:"toren",b:"loper",n:"paard",p:"pion"},en:{K:"King",Q:"Queen",R:"Rook",B:"Bishop",N:"Knight",P:"Pawn",k:"king",q:"queen",r:"rook",b:"bishop",n:"knight",p:"pawn"}},n=e.charAt(0);return t[L][n]||e}const P={K:"â™”",Q:"â™•",R:"â™–",B:"â™—",N:"â™˜",P:"â™™",k:"â™š",q:"â™›",r:"â™œ",b:"â™",n:"â™ž",p:"â™Ÿ",P0:"â™™",P1:"â™™",P2:"â™™",P3:"â™™",P4:"â™™",P5:"â™™",P6:"â™™",P7:"â™™",p0:"â™Ÿ",p1:"â™Ÿ",p2:"â™Ÿ",p3:"â™Ÿ",p4:"â™Ÿ",p5:"â™Ÿ",p6:"â™Ÿ",p7:"â™Ÿ"},Se={q:5,r:4,b:3,n:2,p:1,k:6},Me=[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]],Te=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]],Oe=[[-1,-1],[-1,1],[1,-1],[1,1]],Be=[[-1,0],[1,0],[0,-1],[0,1]],Re="abcdefgh",Le="87654321";function y(e){return e===e.toUpperCase()}function M(e){return e.charAt(0).toLowerCase()==="p"}function $(e){return e.charAt(0).toLowerCase()}function me(e){return Se[$(e)]||0}function j(e,t){return Re[t]+Le[e]}function Y(e){return e.map(t=>P[t]).join("")}let k=ye();function ye(){return{board:Ie(),currentTurn:"white",selectedSquare:null,selectedUnklikPiece:null,validMoves:[],moveHistory:[],castlingRights:{white:{kingSide:!0,queenSide:!0},black:{kingSide:!0,queenSide:!0}},enPassantTarget:null,movedPawns:new Set,autoPromoteToQueen:!1,pendingPromotion:null,gameOver:!1}}function Ie(){return Array(8).fill(null).map(()=>Array(8).fill(null).map(()=>({pieces:[]})))}function Ke(){k=ye(),k.board[7][0].pieces=["R"],k.board[7][1].pieces=["N"],k.board[7][2].pieces=["B"],k.board[7][3].pieces=["Q"],k.board[7][4].pieces=["K"],k.board[7][5].pieces=["B"],k.board[7][6].pieces=["N"],k.board[7][7].pieces=["R"];for(let e=0;e<8;e++)k.board[6][e].pieces=[`P${e}`];k.board[0][0].pieces=["r"],k.board[0][1].pieces=["n"],k.board[0][2].pieces=["b"],k.board[0][3].pieces=["q"],k.board[0][4].pieces=["k"],k.board[0][5].pieces=["b"],k.board[0][6].pieces=["n"],k.board[0][7].pieces=["r"];for(let e=0;e<8;e++)k.board[1][e].pieces=[`p${e}`]}function T(){return k.board}function S(){return k.currentTurn}function ce(){return k.selectedSquare}function we(){return k.selectedUnklikPiece}function le(){return k.validMoves}function he(){return k.moveHistory}function z(){return k.castlingRights}function H(){return k.enPassantTarget}function A(){return k.movedPawns}function fe(){return k.autoPromoteToQueen}function be(){return k.pendingPromotion}function xe(){return k.gameOver}function X(e){k.selectedSquare=e}function ee(e){k.selectedUnklikPiece=e}function D(e){k.validMoves=e}function ke(e){k.enPassantTarget=e}function ze(e){k.autoPromoteToQueen=e}function te(e){k.pendingPromotion=e}function He(e){k.gameOver=e}function re(){k.currentTurn=k.currentTurn==="white"?"black":"white"}function ae(e){k.moveHistory.push(e)}function Ae(e){k.movedPawns.add(e)}function K(e,t,n,s,i){n===7&&s===0&&i.includes("R")&&(k.castlingRights.white.queenSide=!1),n===7&&s===7&&i.includes("R")&&(k.castlingRights.white.kingSide=!1),n===0&&s===0&&i.includes("r")&&(k.castlingRights.black.queenSide=!1),n===0&&s===7&&i.includes("r")&&(k.castlingRights.black.kingSide=!1),i.includes("R")&&e===7&&t===0&&(k.castlingRights.white.queenSide=!1),i.includes("R")&&e===7&&t===7&&(k.castlingRights.white.kingSide=!1),i.includes("r")&&e===0&&t===0&&(k.castlingRights.black.queenSide=!1),i.includes("r")&&e===0&&t===7&&(k.castlingRights.black.kingSide=!1)}function ne(e){e==="white"?k.castlingRights.white={kingSide:!1,queenSide:!1}:k.castlingRights.black={kingSide:!1,queenSide:!1}}function V(){k.selectedSquare=null,k.selectedUnklikPiece=null,k.validMoves=[]}function b(e,t,n){k.board[e][t].pieces=n}function oe(e,t){return k.board[e][t].pieces}function ie(e,t,n,s){for(let i=0;i<8;i++)for(let c=0;c<8;c++){const l=e[i][c].pieces;if(l.length!==0&&y(l[0])!==s){for(const r of l)if(We(e,i,c,r,t,n))return!0}}return!1}function We(e,t,n,s,i,c){const l=$(s),r=y(s);if(l==="p"){const o=r?-1:1;return Math.abs(n-c)===1&&t+o===i}if(l==="n"){const o=Math.abs(t-i),d=Math.abs(n-c);return o===2&&d===1||o===1&&d===2}if(l==="k")return Math.abs(t-i)<=1&&Math.abs(n-c)<=1;if((l==="b"||l==="q")&&Math.abs(t-i)===Math.abs(n-c)){const o=i>t?1:-1,d=c>n?1:-1;let f=t+o,m=n+d;for(;f!==i||m!==c;){if(e[f][m].pieces.length>0)return!1;f+=o,m+=d}return!0}if((l==="r"||l==="q")&&(t===i||n===c)){const o=t===i?0:i>t?1:-1,d=n===c?0:c>n?1:-1;let f=t+o,m=n+d;for(;f!==i||m!==c;){if(e[f][m].pieces.length>0)return!1;f+=o,m+=d}return!0}return!1}function Z(e,t,n,s,i,c,l){const r=[],o=y(s),d=$(s);if(d==="p"){const f=o?-1:1,m=o?6:1;t+f>=0&&t+f<8&&e[t+f][n].pieces.length===0&&(r.push([t+f,n]),t===m&&!l.has(s)&&e[t+2*f][n].pieces.length===0&&r.push([t+2*f,n]));for(const p of[-1,1]){const a=n+p;if(a>=0&&a<8&&t+f>=0&&t+f<8){const u=e[t+f][a];u.pieces.length>0&&y(u.pieces[0])!==o&&r.push([t+f,a]),c&&c.row===t+f&&c.col===a&&r.push([t+f,a,"en-passant"])}}}if(d==="n")for(const[f,m]of Me){const p=t+f,a=n+m;p>=0&&p<8&&a>=0&&a<8&&r.push([p,a])}if(d==="b"||d==="q")for(const[f,m]of Oe)for(let p=1;p<8;p++){const a=t+f*p,u=n+m*p;if(a<0||a>=8||u<0||u>=8||(r.push([a,u]),e[a][u].pieces.length>0))break}if(d==="r"||d==="q")for(const[f,m]of Be)for(let p=1;p<8;p++){const a=t+f*p,u=n+m*p;if(a<0||a>=8||u<0||u>=8||(r.push([a,u]),e[a][u].pieces.length>0))break}if(d==="k"){for(const[p,a]of Te){const u=t+p,v=n+a;if(u>=0&&u<8&&v>=0&&v<8){const g=e[u][v];(g.pieces.length===0||y(g.pieces[0])!==o)&&r.push([u,v])}}const f=o?i.white:i.black,m=o?7:0;if(f.kingSide){const p=e[m][7],a=e[m][5];e[m][6].pieces.length===0&&p.pieces.length>0&&p.pieces.some(u=>$(u)==="r")&&(a.pieces.length===0?p.pieces.length===1?r.push([m,6,"castle-k"]):p.pieces.length===2&&r.push([m,6,"castle-k-choice"]):a.pieces.length===1&&y(a.pieces[0])===o&&(p.pieces.length===1?r.push([m,6,"castle-k-klik"]):p.pieces.length===2&&r.push([m,6,"castle-k-unklik-klik"])))}if(f.queenSide){const p=e[m][0],a=e[m][3],u=e[m][2],v=e[m][1];u.pieces.length===0&&v.pieces.length===0&&p.pieces.length>0&&p.pieces.some(g=>$(g)==="r")&&(a.pieces.length===0?p.pieces.length===1?r.push([m,2,"castle-q"]):p.pieces.length===2&&r.push([m,2,"castle-q-choice"]):a.pieces.length===1&&y(a.pieces[0])===o&&(p.pieces.length===1?r.push([m,2,"castle-q-klik"]):p.pieces.length===2&&r.push([m,2,"castle-q-unklik-klik"])))}}return r}function W(e,t,n,s,i,c,l,r){const o=e.map(p=>p.map(a=>({pieces:[...a.pieces]}))),d=y(c[0]);if(l==="en-passant"){const p=d?s+1:s-1;o[p][i].pieces=[],o[s][i].pieces=[...c],o[t][n].pieces=[]}else if(l==="en-passant-unklik"){const p=d?s+1:s-1;o[p][i].pieces=[];const a=c[r];o[s][i].pieces=[a],o[t][n].pieces=o[t][n].pieces.filter((u,v)=>v!==r)}else if(l==="unklik"||l==="unklik-klik"){const p=c[r];l==="unklik-klik"?o[s][i].pieces=[...o[s][i].pieces,p]:o[s][i].pieces=[p],o[t][n].pieces=o[t][n].pieces.filter((a,u)=>u!==r)}else if(l==="klik")o[s][i].pieces=[...o[s][i].pieces,...c],o[t][n].pieces=[];else if(l?.startsWith("castle-")){const p=l.startsWith("castle-k"),a=p?7:0,u=p?5:3;o[s][i].pieces=c,o[t][n].pieces=[];const v=[...o[t][a].pieces];if(o[t][a].pieces=[],l.includes("unklik-klik")){const h=v.find(w=>$(w)==="r"),E=[...o[t][u].pieces];o[t][u].pieces=[h,...E]}else if(l.includes("klik")&&!l.includes("unklik")){const h=[...o[t][u].pieces];o[t][u].pieces=[...v,...h]}else if(l.includes("both"))o[t][u].pieces=v;else if(v.length===2){const h=v.find(E=>$(E)==="r");o[t][u].pieces=[h]}else o[t][u].pieces=v;const g=p?n+1:n-1;for(const h of[n,g,i])if(ie(o,t,h,d))return!0}else o[s][i].pieces=[...c],o[t][n].pieces=[];let f=-1,m=-1;for(let p=0;p<8;p++){for(let a=0;a<8;a++)if(o[p][a].pieces.includes(d?"K":"k")){f=p,m=a;break}if(f!==-1)break}return f===-1?!1:ie(o,f,m,d)}function se(e,t,n,s,i,c,l,r){const o=new Map,d=y(s[0]),f=s.length===1,m=s.some(a=>M(a));for(const a of s){const u=Z(e,t,n,a,i,c,l);for(const v of u){const[g,h,E]=v,w=`${g},${h}`,C=e[g][h],N=M(a),q=d&&g===0||!d&&g===7;if(m&&s.length===2&&!N&&q||m&&(d&&g===7||!d&&g===0))continue;if(E==="en-passant"){const I=o.get(w);I&&I.type!=="en-passant"?o.set(w,{row:g,col:h,type:"en-passant-choice"}):o.set(w,{row:g,col:h,type:"en-passant"});continue}const Q=o.get(w);if(Q&&Q.type==="en-passant"){o.set(w,{row:g,col:h,type:"en-passant-choice"});continue}if(!f)(C.pieces.length===0||y(C.pieces[0])!==d)&&o.set(w,{row:g,col:h,type:E||"normal"});else if(C.pieces.length>0&&y(C.pieces[0])===d){const I=M(a),Ee=I&&n===h,ue=!C.pieces.some(J=>$(J)==="k")&&!s.some(J=>$(J)==="k");Ee&&C.pieces.length<2&&ue?o.set(w,{row:g,col:h,type:"klik"}):!I&&C.pieces.length<2&&ue&&o.set(w,{row:g,col:h,type:"klik"})}else(C.pieces.length===0||y(C.pieces[0])!==d)&&o.set(w,{row:g,col:h,type:E||"normal"})}}if(f){const a=s.find(u=>M(u));if(a){const u=d?-1:1,v=d?6:1;if(t+u>=0&&t+u<8){const g=e[t+u][n];if(g.pieces.length===1&&y(g.pieces[0])===d&&!g.pieces.some(h=>$(h)==="k")){const h=`${t+u},${n}`;o.set(h,{row:t+u,col:n,type:"klik"})}}if(t===v&&!l.has(a)&&t+2*u>=0&&t+2*u<8){const g=e[t+2*u][n];if(e[t+u][n].pieces.length===0&&g.pieces.length===1&&y(g.pieces[0])===d&&!g.pieces.some(h=>$(h)==="k")){const h=`${t+2*u},${n}`;o.set(h,{row:t+2*u,col:n,type:"klik"})}}}}let p=Array.from(o.values());return p=p.filter(a=>!W(e,t,n,a.row,a.col,s,a.type,r)),p}function Qe(e,t){const n=t==="white";let s=-1,i=-1;for(let c=0;c<8;c++){for(let l=0;l<8;l++)if(e[c][l].pieces.includes(n?"K":"k")){s=c,i=l;break}if(s!==-1)break}return s===-1?!1:ie(e,s,i,n)}function je(e,t,n,s,i){const c=t==="white";for(let l=0;l<8;l++)for(let r=0;r<8;r++){const o=e[l][r].pieces;if(!(o.length===0||y(o[0])!==c)){if(se(e,l,r,o,n,s,i,null).length>0)return!0;if(o.length===2)for(let d=0;d<2;d++){const f=o[d],m=Z(e,l,r,f,n,s,i);for(const p of m){const[a,u]=p,v=e[a][u];if(v.pieces.length===0||y(v.pieces[0])!==c){if(!W(e,l,r,a,u,o,"unklik",d))return!0}else if(v.pieces.length<2&&y(v.pieces[0])===c&&!v.pieces.some(g=>$(g)==="k")&&!W(e,l,r,a,u,o,"unklik-klik",d))return!0}}}}return!1}window.handleSquareClick=Ce;window.handleUnklikSelect=Je;window.initializeBoard=de;window.toggleAutoPromote=Ye;window.executePromotion=$e;window.executeCastling=_;window.movePiece=F;window.switchLanguage=Ue;function Ue(){const e=O()==="nl"?"en":"nl";Pe(e),B(),R(),Ge()}function Ge(){const e=document.querySelector(".header h1");e&&(e.textContent=`ðŸ‘‘ ${x("title")}`);const t=document.querySelector(".header p");t&&(t.textContent=x("subtitle"));const n=document.querySelector(".new-game-btn");n&&(n.textContent=`ðŸ”„ ${x("newGame")}`);const s=document.querySelector(".panel h2");if(s){const d=document.getElementById("moveCount")?.textContent||"0";s.innerHTML=`ðŸ“‹ ${x("moves")} (<span id="moveCount">${d}</span>)`}const i=document.querySelector(".rules h2");i&&(i.textContent=`âš¡ ${x("gameRules")}`);const c=document.querySelectorAll(".rules p");c.length>=4&&(c[0].innerHTML=`<strong style="color: #c084fc;">${x("klik")}</strong> ${O()==="nl"?"Selecteer stuk, klik op veld met blauwe ring":"Select piece, click square with blue ring"}`,c[1].innerHTML=`<strong style="color: #60a5fa;">${x("unklik")}</strong> ${O()==="nl"?"Klik op driehoek met het stuk":"Click triangle with the piece"}`,c[2].innerHTML=`âš ï¸ ${x("kingWarning")}`,c[3].innerHTML=`ðŸ’¡ ${x("promotionTip")}`);const l=document.querySelector('label[for="autoPromote"]');l&&(l.textContent=x("autoPromote"));const r=document.querySelector("#selectedInfo h2");r&&(r.textContent=x("selected"));const o=document.getElementById("langBtn");o&&(o.textContent=O()==="nl"?"ðŸ‡¬ðŸ‡§":"ðŸ‡³ðŸ‡±")}function De(e,t,n,s){if(e.length===0)return"";const i=v=>y(v)?"piece piece-white":"piece piece-black";if(e.length===1)return`<div class="${i(e[0])}">${P[e[0]]}</div>`;const c=[...e].sort((v,g)=>me(g)-me(v)),l=c[0],r=c[1],o=y(e[0]),d=we(),f=s&&d!==null&&e.indexOf(l)===d,m=s&&d!==null&&e.indexOf(r)===d,p=s&&d===null,a=S(),u=o&&a==="white"||!o&&a==="black";return`<div class="stacked-piece">
    <svg class="stacked-svg" viewBox="0 0 64 64">
      <line x1="32" y1="0" x2="0" y2="64" stroke="rgba(100,100,100,0.4)" stroke-width="2"/>
      <line x1="32" y1="0" x2="64" y2="64" stroke="rgba(100,100,100,0.4)" stroke-width="2"/>
    </svg>
    ${p?'<div class="whole-selected"></div>':""}
    <div class="stacked-center">
      <div class="stacked-top ${i(r)}">${P[r]}</div>
      <div class="stacked-bottom ${i(l)}">${P[l]}</div>
    </div>
    ${u?`
      <div class="triangle-left ${f?"selected":""}" onclick="handleUnklikSelect(${t},${n},${e.indexOf(l)},event)" title="${O()==="nl"?"Zet met":"Move with"} ${G(l)}">
        <span class="triangle-symbol left ${i(l)}">${P[l]}</span>
      </div>
      <div class="triangle-right ${m?"selected":""}" onclick="handleUnklikSelect(${t},${n},${e.indexOf(r)},event)" title="${O()==="nl"?"Zet met":"Move with"} ${G(r)}">
        <span class="triangle-symbol right ${i(r)}">${P[r]}</span>
      </div>
    `:""}
    ${!f&&!p?'<div class="triangle-bg-left"></div>':""}
    ${!m&&!p?'<div class="triangle-bg-right"></div>':""}
  </div>`}function B(){const e=document.getElementById("board");if(!e)return;const t=T(),n=ce(),s=le();e.innerHTML="";for(let i=0;i<8;i++){const c=document.createElement("div");c.className="board-row";for(let l=0;l<8;l++){const r=document.createElement("div"),o=(i+l)%2===0;r.className=`square ${o?"light":"dark"}`,n&&n[0]===i&&n[1]===l&&r.classList.add("selected");const d=t[i][l].pieces,f=n&&n[0]===i&&n[1]===l;r.innerHTML=De(d,i,l,!!f);const m=s.find(p=>p.row===i&&p.col===l);if(m){const p=document.createElement("div");m.type==="klik"?p.className="valid-klik":m.type==="unklik-klik"?p.className="valid-unklik-klik":d.length>0?p.className="valid-capture":p.className="valid-move",r.appendChild(p)}r.onclick=p=>{const a=p.target;!a.classList.contains("triangle-left")&&!a.classList.contains("triangle-right")&&Ce(i,l)},c.appendChild(r)}e.appendChild(c)}}function R(){const e=document.getElementById("turnIndicator");e&&(e.textContent=S()==="white"?x("whiteToMove"):x("blackToMove"),e.className=`turn-indicator ${S()==="white"?"turn-white":"turn-black"}`);const t=document.getElementById("moveCount");t&&(t.textContent=String(Math.ceil(he().length/2)));const n=document.getElementById("moveHistory"),s=he();if(n)if(s.length===0)n.innerHTML=`<p style="color:#94a3b8;text-align:center;padding:16px 0;">${x("noMoves")}</p>`;else{const i=[];for(let c=0;c<s.length;c+=2){const l=s[c],r=c+1<s.length?s[c+1]:null;i.push({moveNumber:Math.floor(c/2)+1,white:l,black:r})}n.innerHTML=i.slice(-10).reverse().map(c=>{const l=c.white?c.white.notation:"",r=c.black?c.black.notation:"";return`<div class="move-pair">
          <span class="move-number">${c.moveNumber}.</span>
          <span class="move-white">${l}</span>
          <span class="move-black">${r}</span>
        </div>`}).join("")}Ze()}function Ze(){const e=document.getElementById("selectedInfo");if(!e)return;const t=ce();if(t&&T()[t[0]][t[1]].pieces.length>0){e.classList.add("show");const n=T()[t[0]][t[1]].pieces,s=r=>y(r)?"selected-piece-icon piece piece-white":"selected-piece-icon piece piece-black",i=document.getElementById("selectedPieces");i&&(i.innerHTML=n.map(r=>`<div class="${s(r)}">${P[r]}</div>`).join(""));const c=document.getElementById("selectedNames");c&&(c.textContent=n.map(r=>G(r)).join(" + "));const l=document.getElementById("selectedMoves");l&&(l.textContent=`${le().length} ${x("possibleMoves")}`)}else e.classList.remove("show")}function _e(){const e=document.getElementById("checkIndicator");e&&e.remove();const t=document.createElement("div");t.id="checkIndicator",t.className="check-indicator",t.textContent=x("check");const n=document.querySelector(".board-container");n&&(n.style.position="relative",n.appendChild(t)),setTimeout(()=>{const s=document.getElementById("checkIndicator");s&&s.remove()},3e3)}function ge(e,t){const n=document.createElement("div");n.className="promotion-overlay",n.id="gameOverOverlay";const s=document.createElement("div");s.className="game-over-box";const i=document.createElement("div");i.className="game-over-title",i.textContent=x(e==="checkmate"?"checkmate":"stalemate"),s.appendChild(i);const c=document.createElement("div");if(c.className="game-over-message",e==="stalemate")c.textContent=x("gameEndsDraw");else{const r=t==="white"?O()==="nl"?"Wit":"White":O()==="nl"?"Zwart":"Black";c.textContent=`${r} ${x("wins")}`}s.appendChild(c);const l=document.createElement("button");l.className="game-over-btn",l.textContent=x("newGame"),l.onclick=()=>de(),s.appendChild(l),n.appendChild(s),document.body.appendChild(n)}function ve(){const e=be();if(!e)return;const t=document.createElement("div");t.className="promotion-overlay",t.id="promotionOverlay";const n=e.isWhite,s=n?["Q","R","B","N"]:["q","r","b","n"],i=document.createElement("div");i.className="promotion-box";const c=document.createElement("div");c.className="promotion-title",c.textContent=x("choosePromotion"),i.appendChild(c);const l=document.createElement("div");l.className="promotion-pieces",s.forEach(r=>{const o=document.createElement("div");o.className="promotion-choice";const d=document.createElement("div");d.className=`promotion-piece piece ${n?"piece-white":"piece-black"}`,d.textContent=P[r],o.appendChild(d),o.onclick=()=>$e(r),l.appendChild(o)}),i.appendChild(l),t.appendChild(i),document.body.appendChild(t)}function Fe(e,t,n,s,i){const c=document.createElement("div");c.className="promotion-overlay",c.id="castlingChoiceOverlay";const l=i.includes("k")?7:0,r=T()[e][l].pieces,o=r.find(q=>$(q)==="r"),d=r.find(q=>$(q)!=="r"),f=y(o),m=document.createElement("div");m.className="promotion-box";const p=document.createElement("div");p.className="promotion-title",p.textContent=x("chooseCastling"),m.appendChild(p);const a=document.createElement("div");a.className="promotion-pieces",a.style.gap="20px";const u=document.createElement("div");u.className="promotion-choice",u.style.cssText="width:120px;height:100px;flex-direction:column;display:flex;justify-content:center;align-items:center;";const v=document.createElement("div");v.className=`promotion-piece piece ${f?"piece-white":"piece-black"}`,v.textContent=P[o],v.style.fontSize="48px",u.appendChild(v);const g=document.createElement("div");g.textContent=x("onlyRook"),g.style.cssText="font-size:12px;margin-top:5px;color:white;",u.appendChild(g),u.onclick=()=>{document.getElementById("castlingChoiceOverlay")?.remove(),_(e,t,n,s,i.replace("-choice",""))},a.appendChild(u);const h=document.createElement("div");h.className="promotion-choice",h.style.cssText="width:120px;height:100px;flex-direction:column;display:flex;justify-content:center;align-items:center;";const E=document.createElement("div");E.style.cssText="display:flex;gap:5px;";const w=document.createElement("div");w.className=`piece ${f?"piece-white":"piece-black"}`,w.textContent=P[o],w.style.fontSize="36px";const C=document.createElement("div");C.className=`piece ${f?"piece-white":"piece-black"}`,C.textContent=P[d],C.style.fontSize="36px",E.appendChild(w),E.appendChild(C),h.appendChild(E);const N=document.createElement("div");N.textContent=x("bothPieces"),N.style.cssText="font-size:12px;margin-top:5px;color:white;",h.appendChild(N),h.onclick=()=>{document.getElementById("castlingChoiceOverlay")?.remove(),_(e,t,n,s,i.replace("-choice","-both"))},a.appendChild(h),m.appendChild(a),c.appendChild(m),document.body.appendChild(c)}function Ve(e,t,n,s){const i=document.createElement("div");i.className="promotion-overlay",i.id="enPassantChoiceOverlay";const c=T()[e][t].pieces,l=y(c[0]),r=c.find(q=>$(q)==="p"),o=c.find(q=>$(q)!=="p"),d=document.createElement("div");d.className="promotion-box";const f=document.createElement("div");f.className="promotion-title",f.textContent=x("chooseMove"),d.appendChild(f);const m=document.createElement("div");m.className="promotion-pieces",m.style.gap="20px";const p=document.createElement("div");p.className="promotion-choice",p.style.cssText="width:140px;height:110px;flex-direction:column;display:flex;justify-content:center;align-items:center;";const a=document.createElement("div");a.style.cssText="display:flex;gap:5px;";const u=document.createElement("div");u.className=`piece ${l?"piece-white":"piece-black"}`,u.textContent=P[r],u.style.fontSize="48px",a.appendChild(u),p.appendChild(a);const v=document.createElement("div");v.textContent=x("enPassant"),v.style.cssText="font-size:12px;margin-top:5px;color:white;",p.appendChild(v);const g=document.createElement("div");g.textContent=x("pawnCaptures"),g.style.cssText="font-size:10px;color:#64748b;",p.appendChild(g),p.onclick=()=>{document.getElementById("enPassantChoiceOverlay")?.remove(),F(e,t,n,s,"en-passant")},m.appendChild(p);const h=document.createElement("div");h.className="promotion-choice",h.style.cssText="width:140px;height:110px;flex-direction:column;display:flex;justify-content:center;align-items:center;";const E=document.createElement("div");E.style.cssText="display:flex;gap:5px;";const w=document.createElement("div");w.className=`piece ${l?"piece-white":"piece-black"}`,w.textContent=P[o],w.style.fontSize="48px",E.appendChild(w),h.appendChild(E);const C=document.createElement("div");C.textContent=x("normalMove"),C.style.cssText="font-size:12px;margin-top:5px;color:white;",h.appendChild(C);const N=document.createElement("div");N.textContent=`(${G(o)} ${x("moves_")})`,N.style.cssText="font-size:10px;color:#64748b;",h.appendChild(N),h.onclick=()=>{document.getElementById("enPassantChoiceOverlay")?.remove(),F(e,t,n,s,"normal")},m.appendChild(h),d.appendChild(m),i.appendChild(d),document.body.appendChild(i)}function Ce(e,t){if(xe())return;const n=T(),s=n[e][t],i=ce();if(i){const[c,l]=i,r=le().find(o=>o.row===e&&o.col===t);if(r){const o=r.type;o==="castle-k"||o==="castle-q"||o==="castle-k-klik"||o==="castle-q-klik"||o==="castle-k-unklik-klik"||o==="castle-q-unklik-klik"?_(c,l,e,t,o):o==="castle-k-choice"||o==="castle-q-choice"?Fe(c,l,e,t,o):o==="en-passant-choice"?Ve(c,l,e,t):F(c,l,e,t,o)}else if(s.pieces.length>0&&y(s.pieces[0])===(S()==="white")){X([e,t]),ee(null);const o=se(n,e,t,s.pieces,z(),H(),A(),null);D(o)}else V()}else if(s.pieces.length>0){const c=y(s.pieces[0]);if(c&&S()==="white"||!c&&S()==="black"){X([e,t]),ee(null);const l=se(n,e,t,s.pieces,z(),H(),A(),null);D(l)}}B(),R()}function Je(e,t,n,s){if(xe())return;s.stopPropagation();const i=T(),c=i[e][t],l=c.pieces[n],r=y(l);if(r&&S()!=="white"||!r&&S()!=="black")return;if(X([e,t]),ee(n),$(l)==="k"){const p=Z(i,e,t,l,z(),H(),A()).map(a=>({row:a[0],col:a[1],type:"unklik"})).filter(a=>!W(i,e,t,a.row,a.col,c.pieces,"unklik",n));D(p),B(),R();return}const o=Z(i,e,t,l,z(),H(),A()),d=[],f=M(l);for(const p of o){const[a,u,v]=p,g=i[a][u];f&&(r&&a===7||!r&&a===0)||(v==="en-passant"?d.push({row:a,col:u,type:"en-passant-unklik"}):g.pieces.length===0||y(g.pieces[0])!==r?d.push({row:a,col:u,type:"unklik"}):g.pieces.length<2&&y(g.pieces[0])===r&&!g.pieces.some(h=>$(h)==="k")&&d.push({row:a,col:u,type:"unklik-klik"}))}const m=d.filter(p=>!W(i,e,t,p.row,p.col,c.pieces,p.type,n));D(m),B(),R()}function _(e,t,n,s,i){const c=T(),l=i.startsWith("castle-k"),r=l?7:0,o=l?5:3,d=c[e][t].pieces;b(n,s,d),b(e,t,[]);const f=[...c[e][r].pieces];b(e,r,[]);let m=`O-O${l?"":"-O"}`;if(i.includes("unklik-klik")){const a=f.find(g=>$(g)==="r"),u=f.find(g=>$(g)!=="r"),v=[...c[e][o].pieces];b(e,o,[a,...v]),b(e,r,[u]),m+=" (toren klikt)"}else if(i.includes("klik")&&!i.includes("unklik")){const a=[...c[e][o].pieces];b(e,o,[...f,...a]),m+=" klikt"}else if(i.includes("both"))b(e,o,f),m+=" (beide)";else if(f.length===2){const a=f.find(v=>$(v)==="r"),u=f.find(v=>$(v)!=="r");b(e,o,[a]),b(e,r,[u]),m+=" (alleen toren)"}else b(e,o,f);ne(S()),V();const p=S();re(),ae({turn:p,notation:m}),B(),R(),pe()}function F(e,t,n,s,i){const c=T(),l=c[e][t],r=c[n][s];let o,d="";ke(null);const f=r.pieces.length>0,m=j(e,t),p=j(n,s),a=we();if(i==="unklik"||i==="unklik-klik"||i==="en-passant-unklik"){const h=l.pieces[a],E=l.pieces.filter((N,q)=>q!==a);if(o=[h],b(e,t,E),d=`${P[h]}${m}-${p}`,i==="en-passant-unklik"){const N=S()==="white"?n+1:n-1;b(N,s,[]),b(n,s,[h]),d+=` x${j(N,s)} e.p.`,K(e,t,n,s,o),U(d);return}const w=M(h),C=y(h)&&n===0||!y(h)&&n===7;if(w&&C){if(i==="unklik-klik"?(b(n,s,[...r.pieces,h]),d+=" klikt"):r.pieces.length>0?(b(n,s,[h]),d+=" x"):b(n,s,[h]),fe()){const N=y(h)?"Q":"q",q=oe(n,s).filter(Q=>!M(Q));q.unshift(N),b(n,s,q),d+="="+P[N],K(e,t,n,s,q),U(d)}else{const N={row:n,col:s,isWhite:y(h),moveNotation:d,wasCapture:r.pieces.length>1||i!=="unklik-klik"&&r.pieces.length>0};te(N),ve()}return}i==="unklik-klik"?(b(n,s,[...r.pieces,h]),d+=" klikt"):(r.pieces.length>0&&(d=`${P[h]}${m}x${p}`),b(n,s,[h])),K(e,t,n,s,o)}else if(i==="en-passant"){o=[...l.pieces],b(e,t,[]);const h=S()==="white"?n+1:n-1;b(h,s,[]),b(n,s,o),d=`${Y(o)}${m}x${j(h,s)} e.p.`}else{o=[...l.pieces],b(e,t,[]),d=`${Y(o)}${m}-${p}`;const h=o.some(w=>M(w)),E=y(o[0])&&n===0||!y(o[0])&&n===7;if(h&&E){if(i==="klik"?(b(n,s,[...r.pieces,...o]),d+=" klikt"):(r.pieces.length>0&&(d+=" x"),b(n,s,o)),fe()){const w=y(o[0])?"Q":"q",C=oe(n,s).filter(N=>!M(N));C.unshift(w),b(n,s,C),d+="="+P[w],K(e,t,n,s,C),U(d)}else{const w={row:n,col:s,isWhite:y(o[0]),moveNotation:d,otherPieces:o.filter(C=>!M(C)),wasCapture:r.pieces.length>o.length};te(w),ve()}return}i==="klik"?(b(n,s,[...r.pieces,...o]),d+=" klikt"):(r.pieces.length>0&&(d=`${Y(o)}${m}x${p}`),b(n,s,o)),K(e,t,n,s,o)}const u=o.some(h=>M(h)),v=t===s,g=y(o[0])&&e===6||!y(o[0])&&e===1;if(u&&v&&g&&!f&&Math.abs(e-n)===2){const h=(e+n)/2;ke({row:h,col:s})}o.includes("K")?ne("white"):o.includes("k")&&ne("black");for(const h of o)M(h)&&Ae(h);U(d)}function U(e){V();const t=S();re(),ae({turn:t,notation:e}),B(),R(),pe()}function $e(e){const t=be();if(!t)return;const{row:n,col:s,moveNotation:i}=t,c=oe(n,s).filter(d=>!M(d));c.unshift(e),b(n,s,c);const l=document.getElementById("promotionOverlay");l&&l.remove();const r=i+"="+P[e];V();const o=S();re(),ae({turn:o,notation:r}),te(null),B(),R(),pe()}function pe(){const e=T(),t=S(),n=Qe(e,t);je(e,t,z(),H(),A())?n&&_e():(He(!0),n?ge("checkmate",t==="white"?"black":"white"):ge("stalemate",null))}function de(){Ke(),B(),R()}function Ye(){const e=document.getElementById("autoPromote");ze(e.checked)}qe();document.addEventListener("DOMContentLoaded",()=>{de()});
