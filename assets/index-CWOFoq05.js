(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();const Me={nl:{title:"Klikschaak",subtitle:"Combineer stukken voor strategische dominantie",newGame:"Nieuw Spel",whiteToMove:"Wit aan zet",blackToMove:"Zwart aan zet",moves:"Zetten",noMoves:"Nog geen zetten",gameRules:"Spelregels",klik:"Klikken:",unklik:"Ontklikken:",kingWarning:"Koning mag NOOIT klikken!",promotionTip:"Promotie: alleen met een pionzet!",autoPromote:"Automatisch promoveren tot dame",selected:"Geselecteerd",possibleMoves:"mogelijke zetten",choosePromotion:"Kies een stuk voor promotie:",chooseCastling:"Kies rokade optie:",onlyRook:"Alleen toren",bothPieces:"Beide stukken",chooseMove:"Kies zet type:",enPassant:"En passant",normalMove:"Normale zet",pawnCaptures:"(pion slaat)",moves_:"beweegt",checkmate:"Schaakmat!",stalemate:"Pat!",check:"SCHAAK!",wins:"wint!",draw:"Remise",gameEndsDraw:"Het spel eindigt in remise"},en:{title:"Clickchess",subtitle:"Combine pieces for strategic dominance",newGame:"New Game",whiteToMove:"White to move",blackToMove:"Black to move",moves:"Moves",noMoves:"No moves yet",gameRules:"Game Rules",klik:"Click:",unklik:"Unclick:",kingWarning:"King may NEVER click!",promotionTip:"Promotion: only with a pawn move!",autoPromote:"Auto-promote to queen",selected:"Selected",possibleMoves:"possible moves",choosePromotion:"Choose a piece for promotion:",chooseCastling:"Choose castling option:",onlyRook:"Only rook",bothPieces:"Both pieces",chooseMove:"Choose move type:",enPassant:"En passant",normalMove:"Normal move",pawnCaptures:"(pawn captures)",moves_:"moves",checkmate:"Checkmate!",stalemate:"Stalemate!",check:"CHECK!",wins:"wins!",draw:"Draw",gameEndsDraw:"The game ends in a draw"}};let H="nl";function Ne(e){H=e,localStorage.setItem("klikschaak-language",e)}function T(){return H}function Ce(){const e=localStorage.getItem("klikschaak-language");e&&(e==="nl"||e==="en")?H=e:H=navigator.language.slice(0,2)==="nl"?"nl":"en"}function P(e){return Me[H][e]}function j(e){const t={nl:{K:"Koning",Q:"Dame",R:"Toren",B:"Loper",N:"Paard",P:"Pion",k:"koning",q:"dame",r:"toren",b:"loper",n:"paard",p:"pion"},en:{K:"King",Q:"Queen",R:"Rook",B:"Bishop",N:"Knight",P:"Pawn",k:"king",q:"queen",r:"rook",b:"bishop",n:"knight",p:"pawn"}},n=e.charAt(0);return t[H][n]||e}const M={K:"â™”",Q:"â™•",R:"â™–",B:"â™—",N:"â™˜",P:"â™™",k:"â™š",q:"â™›",r:"â™œ",b:"â™",n:"â™ž",p:"â™Ÿ",P0:"â™™",P1:"â™™",P2:"â™™",P3:"â™™",P4:"â™™",P5:"â™™",P6:"â™™",P7:"â™™",p0:"â™Ÿ",p1:"â™Ÿ",p2:"â™Ÿ",p3:"â™Ÿ",p4:"â™Ÿ",p5:"â™Ÿ",p6:"â™Ÿ",p7:"â™Ÿ"},Oe={q:5,r:4,b:3,n:2,p:1,k:6},Be=[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]],we=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]],Le=[[-1,-1],[-1,1],[1,-1],[1,1]],Te=[[-1,0],[1,0],[0,-1],[0,1]],Ie="abcdefgh",Ke="87654321";function b(e){return e===e.toUpperCase()}function B(e){return e.charAt(0).toLowerCase()==="p"}function $(e){return e.charAt(0).toLowerCase()}function ke(e){return Oe[$(e)]||0}function _(e,t){return Ie[t]+Ke[e]}function R(e){return e.map(t=>M[t]).join("")}let f=ye();function ye(){return{board:We(),currentTurn:"white",selectedSquare:null,selectedUnklikPiece:null,validMoves:[],moveHistory:[],castlingRights:{white:{kingSide:!0,queenSide:!0},black:{kingSide:!0,queenSide:!0}},enPassantTarget:null,movedPawns:new Set,autoPromoteToQueen:!1,pendingPromotion:null,gameOver:!1}}function We(){return Array(8).fill(null).map(()=>Array(8).fill(null).map(()=>({pieces:[]})))}function He(){f=ye(),f.board[7][0].pieces=["R"],f.board[7][1].pieces=["N"],f.board[7][2].pieces=["B"],f.board[7][3].pieces=["Q"],f.board[7][4].pieces=["K"],f.board[7][5].pieces=["B"],f.board[7][6].pieces=["N"],f.board[7][7].pieces=["R"];for(let e=0;e<8;e++)f.board[6][e].pieces=[`P${e}`];f.board[0][0].pieces=["r"],f.board[0][1].pieces=["n"],f.board[0][2].pieces=["b"],f.board[0][3].pieces=["q"],f.board[0][4].pieces=["k"],f.board[0][5].pieces=["b"],f.board[0][6].pieces=["n"],f.board[0][7].pieces=["r"];for(let e=0;e<8;e++)f.board[1][e].pieces=[`p${e}`]}function L(){return f.board}function C(){return f.currentTurn}function ae(){return f.selectedSquare}function Pe(){return f.selectedUnklikPiece}function le(){return f.validMoves}function ge(){return f.moveHistory}function z(){return f.castlingRights}function D(){return f.enPassantTarget}function G(){return f.movedPawns}function fe(){return f.autoPromoteToQueen}function Se(){return f.pendingPromotion}function xe(){return f.gameOver}function ee(e){f.selectedSquare=e}function te(e){f.selectedUnklikPiece=e}function V(e){f.validMoves=e}function me(e){f.enPassantTarget=e}function Ae(e){f.autoPromoteToQueen=e}function ne(e){f.pendingPromotion=e}function ze(e){f.gameOver=e}function re(){f.currentTurn=f.currentTurn==="white"?"black":"white"}function de(e){f.moveHistory.push(e)}function De(e){f.movedPawns.add(e)}function A(e,t,n,c,i){n===7&&c===0&&i.includes("R")&&(f.castlingRights.white.queenSide=!1),n===7&&c===7&&i.includes("R")&&(f.castlingRights.white.kingSide=!1),n===0&&c===0&&i.includes("r")&&(f.castlingRights.black.queenSide=!1),n===0&&c===7&&i.includes("r")&&(f.castlingRights.black.kingSide=!1),i.includes("R")&&e===7&&t===0&&(f.castlingRights.white.queenSide=!1),i.includes("R")&&e===7&&t===7&&(f.castlingRights.white.kingSide=!1),i.includes("r")&&e===0&&t===0&&(f.castlingRights.black.queenSide=!1),i.includes("r")&&e===0&&t===7&&(f.castlingRights.black.kingSide=!1)}function ie(e){e==="white"?f.castlingRights.white={kingSide:!1,queenSide:!1}:f.castlingRights.black={kingSide:!1,queenSide:!1}}function J(){f.selectedSquare=null,f.selectedUnklikPiece=null,f.validMoves=[]}function S(e,t,n){f.board[e][t].pieces=n}function se(e,t){return f.board[e][t].pieces}function ce(e,t,n,c){for(let i=0;i<8;i++)for(let o=0;o<8;o++){const a=e[i][o].pieces;if(a.length!==0&&b(a[0])!==c){for(const l of a)if(Ge(e,i,o,l,t,n))return!0}}return!1}function Ge(e,t,n,c,i,o){const a=$(c),l=b(c);if(a==="p"){const s=l?-1:1;return Math.abs(n-o)===1&&t+s===i}if(a==="n"){const s=Math.abs(t-i),r=Math.abs(n-o);return s===2&&r===1||s===1&&r===2}if(a==="k")return Math.abs(t-i)<=1&&Math.abs(n-o)<=1;if((a==="b"||a==="q")&&Math.abs(t-i)===Math.abs(n-o)){const s=i>t?1:-1,r=o>n?1:-1;let h=t+s,k=n+r;for(;h!==i||k!==o;){if(e[h][k].pieces.length>0)return!1;h+=s,k+=r}return!0}if((a==="r"||a==="q")&&(t===i||n===o)){const s=t===i?0:i>t?1:-1,r=n===o?0:o>n?1:-1;let h=t+s,k=n+r;for(;h!==i||k!==o;){if(e[h][k].pieces.length>0)return!1;h+=s,k+=r}return!0}return!1}function Z(e,t,n,c,i,o,a){const l=[],s=b(c),r=$(c);if(r==="p"){const h=s?-1:1,k=s?6:1;t+h>=0&&t+h<8&&e[t+h][n].pieces.length===0&&(l.push([t+h,n]),t===k&&!a.has(c)&&e[t+2*h][n].pieces.length===0&&l.push([t+2*h,n]));for(const u of[-1,1]){const d=n+u;if(d>=0&&d<8&&t+h>=0&&t+h<8){const p=e[t+h][d];p.pieces.length>0&&b(p.pieces[0])!==s&&l.push([t+h,d]),o&&o.row===t+h&&o.col===d&&l.push([t+h,d,"en-passant"])}}}if(r==="n")for(const[h,k]of Be){const u=t+h,d=n+k;u>=0&&u<8&&d>=0&&d<8&&l.push([u,d])}if(r==="b"||r==="q")for(const[h,k]of Le)for(let u=1;u<8;u++){const d=t+h*u,p=n+k*u;if(d<0||d>=8||p<0||p>=8||(l.push([d,p]),e[d][p].pieces.length>0))break}if(r==="r"||r==="q")for(const[h,k]of Te)for(let u=1;u<8;u++){const d=t+h*u,p=n+k*u;if(d<0||d>=8||p<0||p>=8||(l.push([d,p]),e[d][p].pieces.length>0))break}if(r==="k"){for(const[u,d]of we){const p=t+u,v=n+d;if(p>=0&&p<8&&v>=0&&v<8){const g=e[p][v];(g.pieces.length===0||b(g.pieces[0])!==s)&&l.push([p,v])}}const h=s?i.white:i.black,k=s?7:0;if(h.kingSide){const u=e[k][7],d=e[k][5];e[k][6].pieces.length===0&&u.pieces.length>0&&u.pieces.some(v=>$(v)==="r")&&(d.pieces.length===0?u.pieces.length===1?l.push([k,6,"castle-k"]):u.pieces.length===2&&l.push([k,6,"castle-k-choice"]):d.pieces.length===1&&b(d.pieces[0])===s&&(u.pieces.length===1?l.push([k,6,"castle-k-klik"]):u.pieces.length===2&&l.push([k,6,"castle-k-unklik-klik"])))}if(h.queenSide){const u=e[k][0],d=e[k][3],p=e[k][2],v=e[k][1];p.pieces.length===0&&v.pieces.length===0&&u.pieces.length>0&&u.pieces.some(g=>$(g)==="r")&&(d.pieces.length===0?u.pieces.length===1?l.push([k,2,"castle-q"]):u.pieces.length===2&&l.push([k,2,"castle-q-choice"]):d.pieces.length===1&&b(d.pieces[0])===s&&(u.pieces.length===1?l.push([k,2,"castle-q-klik"]):u.pieces.length===2&&l.push([k,2,"castle-q-unklik-klik"])))}}return l}function U(e,t,n,c,i,o,a,l){const s=e.map(u=>u.map(d=>({pieces:[...d.pieces]}))),r=b(o[0]);if(a==="en-passant"){const u=r?c+1:c-1;s[u][i].pieces=[],s[c][i].pieces=[...o],s[t][n].pieces=[]}else if(a==="en-passant-unklik"){const u=r?c+1:c-1;s[u][i].pieces=[];const d=o[l];s[c][i].pieces=[d],s[t][n].pieces=s[t][n].pieces.filter((p,v)=>v!==l)}else if(a==="unklik"||a==="unklik-klik"){const u=o[l];a==="unklik-klik"?s[c][i].pieces=[...s[c][i].pieces,u]:s[c][i].pieces=[u],s[t][n].pieces=s[t][n].pieces.filter((d,p)=>p!==l)}else if(a==="klik")s[c][i].pieces=[...s[c][i].pieces,...o],s[t][n].pieces=[];else if(a?.startsWith("castle-")){const u=a.startsWith("castle-k"),d=u?7:0,p=u?5:3;s[c][i].pieces=o,s[t][n].pieces=[];const v=[...s[t][d].pieces];if(s[t][d].pieces=[],a.includes("unklik-klik")){const y=v.find(E=>$(E)==="r"),m=[...s[t][p].pieces];s[t][p].pieces=[y,...m]}else if(a.includes("klik")&&!a.includes("unklik")){const y=[...s[t][p].pieces];s[t][p].pieces=[...v,...y]}else if(a.includes("both"))s[t][p].pieces=v;else if(v.length===2){const y=v.find(m=>$(m)==="r");s[t][p].pieces=[y]}else s[t][p].pieces=v;const g=u?n+1:n-1;for(const y of[n,g,i])if(ce(s,t,y,r))return!0}else s[c][i].pieces=[...o],s[t][n].pieces=[];let h=-1,k=-1;for(let u=0;u<8;u++){for(let d=0;d<8;d++)if(s[u][d].pieces.includes(r?"K":"k")){h=u,k=d;break}if(h!==-1)break}return h===-1?!1:ce(s,h,k,r)}function oe(e,t,n,c,i,o,a,l){const s=new Map,r=b(c[0]),h=c.length===1,k=c.some(d=>B(d));for(const d of c){const p=Z(e,t,n,d,i,o,a);for(const v of p){const[g,y,m]=v,E=`${g},${y}`,x=e[g][y],N=B(d),q=r&&g===0||!r&&g===7;if(k&&c.length===2&&!N&&q||k&&(r&&g===7||!r&&g===0))continue;if(m==="en-passant"){const W=s.get(E);W&&W.type!=="en-passant"?s.set(E,{row:g,col:y,type:"en-passant-choice"}):s.set(E,{row:g,col:y,type:"en-passant"});continue}const w=s.get(E);if(w&&w.type==="en-passant"){s.set(E,{row:g,col:y,type:"en-passant-choice"});continue}if(!h)(x.pieces.length===0||b(x.pieces[0])!==r)&&s.set(E,{row:g,col:y,type:m||"normal"});else if(x.pieces.length>0&&b(x.pieces[0])===r){const W=B(d),$e=W&&n===y,he=!x.pieces.some(X=>$(X)==="k")&&!c.some(X=>$(X)==="k");$e&&x.pieces.length<2&&he?s.set(E,{row:g,col:y,type:"klik"}):!W&&x.pieces.length<2&&he&&s.set(E,{row:g,col:y,type:"klik"})}else(x.pieces.length===0||b(x.pieces[0])!==r)&&s.set(E,{row:g,col:y,type:m||"normal"})}}if(h){const d=c.find(p=>B(p));if(d){const p=r?-1:1,v=r?6:1;if(t+p>=0&&t+p<8){const g=e[t+p][n];if(g.pieces.length===1&&b(g.pieces[0])===r&&!g.pieces.some(y=>$(y)==="k")){const y=`${t+p},${n}`;s.set(y,{row:t+p,col:n,type:"klik"})}}if(t===v&&!a.has(d)&&t+2*p>=0&&t+2*p<8){const g=e[t+2*p][n];if(e[t+p][n].pieces.length===0&&g.pieces.length===1&&b(g.pieces[0])===r&&!g.pieces.some(m=>$(m)==="k")){const m=`${t+2*p},${n}`;s.set(m,{row:t+2*p,col:n,type:"klik"})}}}}let u=Array.from(s.values());return u=u.filter(d=>!U(e,t,n,d.row,d.col,c,d.type,l)),u}function Ue(e,t){const n=t==="white";let c=-1,i=-1;for(let o=0;o<8;o++){for(let a=0;a<8;a++)if(e[o][a].pieces.includes(n?"K":"k")){c=o,i=a;break}if(c!==-1)break}return c===-1?!1:ce(e,c,i,n)}function _e(e,t,n,c,i){const o=t==="white";for(let a=0;a<8;a++)for(let l=0;l<8;l++){const s=e[a][l].pieces;if(s.length===0||b(s[0])!==o)continue;if(oe(e,a,l,s,n,c,i,null).length>0)return!0;if(s.length===2)for(let h=0;h<2;h++){const k=s[h],u=Z(e,a,l,k,n,c,i);for(const d of u){const[p,v]=d,g=e[p][v];if(g.pieces.length===0||b(g.pieces[0])!==o){if(!U(e,a,l,p,v,s,"unklik",h))return!0}else if(g.pieces.length<2&&b(g.pieces[0])===o&&!g.pieces.some(y=>$(y)==="k")&&!U(e,a,l,p,v,s,"unklik-klik",h))return!0}}}return!1}window.handleSquareClick=Ee;window.handleUnklikSelect=Xe;window.initializeBoard=pe;window.toggleAutoPromote=Re;window.executePromotion=qe;window.executeCastling=F;window.movePiece=Y;window.switchLanguage=Qe;function Qe(){const e=T()==="nl"?"en":"nl";Ne(e),I(),K(),je()}function je(){const e=document.querySelector(".header h1");e&&(e.textContent=`ðŸ‘‘ ${P("title")}`);const t=document.querySelector(".header p");t&&(t.textContent=P("subtitle"));const n=document.querySelector(".new-game-btn");n&&(n.textContent=`ðŸ”„ ${P("newGame")}`);const c=document.querySelector(".panel h2");if(c){const r=document.getElementById("moveCount")?.textContent||"0";c.innerHTML=`ðŸ“‹ ${P("moves")} (<span id="moveCount">${r}</span>)`}const i=document.querySelector(".rules h2");i&&(i.textContent=`âš¡ ${P("gameRules")}`);const o=document.querySelectorAll(".rules p");o.length>=4&&(o[0].innerHTML=`<strong style="color: #c084fc;">${P("klik")}</strong> ${T()==="nl"?"Selecteer stuk, klik op veld met blauwe ring":"Select piece, click square with blue ring"}`,o[1].innerHTML=`<strong style="color: #60a5fa;">${P("unklik")}</strong> ${T()==="nl"?"Klik op driehoek met het stuk":"Click triangle with the piece"}`,o[2].innerHTML=`âš ï¸ ${P("kingWarning")}`,o[3].innerHTML=`ðŸ’¡ ${P("promotionTip")}`);const a=document.querySelector('label[for="autoPromote"]');a&&(a.textContent=P("autoPromote"));const l=document.querySelector("#selectedInfo h2");l&&(l.textContent=P("selected"));const s=document.getElementById("langBtn");s&&(s.textContent=T()==="nl"?"ðŸ‡¬ðŸ‡§":"ðŸ‡³ðŸ‡±")}function Ve(e,t,n,c){if(e.length===0)return"";const i=v=>b(v)?"piece piece-white":"piece piece-black";if(e.length===1)return`<div class="${i(e[0])}">${M[e[0]]}</div>`;const o=[...e].sort((v,g)=>ke(g)-ke(v)),a=o[0],l=o[1],s=b(e[0]),r=Pe(),h=c&&r!==null&&e.indexOf(a)===r,k=c&&r!==null&&e.indexOf(l)===r,u=c&&r===null,d=C(),p=s&&d==="white"||!s&&d==="black";return`<div class="stacked-piece">
    <svg class="stacked-svg" viewBox="0 0 64 64">
      <line x1="32" y1="0" x2="0" y2="64" stroke="rgba(100,100,100,0.4)" stroke-width="2"/>
      <line x1="32" y1="0" x2="64" y2="64" stroke="rgba(100,100,100,0.4)" stroke-width="2"/>
    </svg>
    ${u?'<div class="whole-selected"></div>':""}
    <div class="stacked-center">
      <div class="stacked-top ${i(l)}">${M[l]}</div>
      <div class="stacked-bottom ${i(a)}">${M[a]}</div>
    </div>
    ${p?`
      <div class="triangle-left ${h?"selected":""}" onclick="handleUnklikSelect(${t},${n},${e.indexOf(a)},event)" title="${T()==="nl"?"Zet met":"Move with"} ${j(a)}">
        <span class="triangle-symbol left ${i(a)}">${M[a]}</span>
      </div>
      <div class="triangle-right ${k?"selected":""}" onclick="handleUnklikSelect(${t},${n},${e.indexOf(l)},event)" title="${T()==="nl"?"Zet met":"Move with"} ${j(l)}">
        <span class="triangle-symbol right ${i(l)}">${M[l]}</span>
      </div>
    `:""}
    ${!h&&!u?'<div class="triangle-bg-left"></div>':""}
    ${!k&&!u?'<div class="triangle-bg-right"></div>':""}
  </div>`}function I(){const e=document.getElementById("board");if(!e)return;const t=L(),n=ae(),c=le();e.innerHTML="";for(let i=0;i<8;i++){const o=document.createElement("div");o.className="board-row";for(let a=0;a<8;a++){const l=document.createElement("div"),s=(i+a)%2===0;l.className=`square ${s?"light":"dark"}`,n&&n[0]===i&&n[1]===a&&l.classList.add("selected");const r=t[i][a].pieces,h=n&&n[0]===i&&n[1]===a;l.innerHTML=Ve(r,i,a,!!h);const k=c.find(u=>u.row===i&&u.col===a);if(k){const u=document.createElement("div");k.type==="klik"?u.className="valid-klik":k.type==="unklik-klik"?u.className="valid-unklik-klik":r.length>0?u.className="valid-capture":u.className="valid-move",l.appendChild(u)}l.onclick=u=>{const d=u.target;!d.classList.contains("triangle-left")&&!d.classList.contains("triangle-right")&&Ee(i,a)},o.appendChild(l)}e.appendChild(o)}}function K(){const e=document.getElementById("turnIndicator");e&&(e.textContent=C()==="white"?P("whiteToMove"):P("blackToMove"),e.className=`turn-indicator ${C()==="white"?"turn-white":"turn-black"}`);const t=document.getElementById("moveCount");t&&(t.textContent=String(Math.ceil(ge().length/2)));const n=document.getElementById("moveHistory"),c=ge();if(n)if(c.length===0)n.innerHTML=`<p style="color:#94a3b8;text-align:center;padding:16px 0;">${P("noMoves")}</p>`;else{const i=[];for(let o=0;o<c.length;o+=2){const a=c[o],l=o+1<c.length?c[o+1]:null;i.push({moveNumber:Math.floor(o/2)+1,white:a,black:l})}n.innerHTML=i.slice(-10).reverse().map(o=>{const a=o.white?o.white.notation:"",l=o.black?o.black.notation:"";return`<div class="move-pair">
          <span class="move-number">${o.moveNumber}.</span>
          <span class="move-white">${a}</span>
          <span class="move-black">${l}</span>
        </div>`}).join("")}Ze()}function Ze(){const e=document.getElementById("selectedInfo");if(!e)return;const t=ae();if(t&&L()[t[0]][t[1]].pieces.length>0){e.classList.add("show");const n=L()[t[0]][t[1]].pieces,c=l=>b(l)?"selected-piece-icon piece piece-white":"selected-piece-icon piece piece-black",i=document.getElementById("selectedPieces");i&&(i.innerHTML=n.map(l=>`<div class="${c(l)}">${M[l]}</div>`).join(""));const o=document.getElementById("selectedNames");o&&(o.textContent=n.map(l=>j(l)).join(" + "));const a=document.getElementById("selectedMoves");a&&(a.textContent=`${le().length} ${P("possibleMoves")}`)}else e.classList.remove("show")}function Fe(){const e=document.getElementById("checkIndicator");e&&e.remove();const t=document.createElement("div");t.id="checkIndicator",t.className="check-indicator",t.textContent=P("check");const n=document.querySelector(".board-container");n&&(n.style.position="relative",n.appendChild(t)),setTimeout(()=>{const c=document.getElementById("checkIndicator");c&&c.remove()},3e3)}function ve(e,t){const n=document.createElement("div");n.className="promotion-overlay",n.id="gameOverOverlay";const c=document.createElement("div");c.className="game-over-box";const i=document.createElement("div");i.className="game-over-title",i.textContent=P(e==="checkmate"?"checkmate":"stalemate"),c.appendChild(i);const o=document.createElement("div");if(o.className="game-over-message",e==="stalemate")o.textContent=P("gameEndsDraw");else{const l=t==="white"?T()==="nl"?"Wit":"White":T()==="nl"?"Zwart":"Black";o.textContent=`${l} ${P("wins")}`}c.appendChild(o);const a=document.createElement("button");a.className="game-over-btn",a.textContent=P("newGame"),a.onclick=()=>pe(),c.appendChild(a),n.appendChild(c),document.body.appendChild(n)}function be(){const e=Se();if(!e)return;const t=document.createElement("div");t.className="promotion-overlay",t.id="promotionOverlay";const n=e.isWhite,c=n?["Q","R","B","N"]:["q","r","b","n"],i=document.createElement("div");i.className="promotion-box";const o=document.createElement("div");o.className="promotion-title",o.textContent=P("choosePromotion"),i.appendChild(o);const a=document.createElement("div");a.className="promotion-pieces",c.forEach(l=>{const s=document.createElement("div");s.className="promotion-choice";const r=document.createElement("div");r.className=`promotion-piece piece ${n?"piece-white":"piece-black"}`,r.textContent=M[l],s.appendChild(r),s.onclick=()=>qe(l),a.appendChild(s)}),i.appendChild(a),t.appendChild(i),document.body.appendChild(t)}function Ye(e,t,n,c,i){const o=document.createElement("div");o.className="promotion-overlay",o.id="castlingChoiceOverlay";const l=i.includes("k")?7:0,r=L()[e][l].pieces,h=r.find(w=>$(w)==="r"),k=r.find(w=>$(w)!=="r"),u=b(h),d=document.createElement("div");d.className="promotion-box";const p=document.createElement("div");p.className="promotion-title",p.textContent=P("chooseCastling"),d.appendChild(p);const v=document.createElement("div");v.className="promotion-pieces",v.style.gap="20px";const g=document.createElement("div");g.className="promotion-choice",g.style.cssText="width:120px;height:100px;flex-direction:column;display:flex;justify-content:center;align-items:center;";const y=document.createElement("div");y.className=`promotion-piece piece ${u?"piece-white":"piece-black"}`,y.textContent=M[h],y.style.fontSize="48px",g.appendChild(y);const m=document.createElement("div");m.textContent=P("onlyRook"),m.style.cssText="font-size:12px;margin-top:5px;color:white;",g.appendChild(m),g.onclick=()=>{document.getElementById("castlingChoiceOverlay")?.remove(),F(e,t,n,c,i.replace("-choice",""))},v.appendChild(g);const E=document.createElement("div");E.className="promotion-choice",E.style.cssText="width:120px;height:100px;flex-direction:column;display:flex;justify-content:center;align-items:center;";const x=document.createElement("div");x.style.cssText="display:flex;gap:5px;";const N=document.createElement("div");N.className=`piece ${u?"piece-white":"piece-black"}`,N.textContent=M[h],N.style.fontSize="36px";const q=document.createElement("div");q.className=`piece ${u?"piece-white":"piece-black"}`,q.textContent=M[k],q.style.fontSize="36px",x.appendChild(N),x.appendChild(q),E.appendChild(x);const O=document.createElement("div");O.textContent=P("bothPieces"),O.style.cssText="font-size:12px;margin-top:5px;color:white;",E.appendChild(O),E.onclick=()=>{document.getElementById("castlingChoiceOverlay")?.remove(),F(e,t,n,c,i.replace("-choice","-both"))},v.appendChild(E),d.appendChild(v),o.appendChild(d),document.body.appendChild(o)}function Je(e,t,n,c){const i=document.createElement("div");i.className="promotion-overlay",i.id="enPassantChoiceOverlay";const a=L()[e][t].pieces,l=b(a[0]),s=a.find(O=>$(O)==="p"),r=a.find(O=>$(O)!=="p"),h=document.createElement("div");h.className="promotion-box";const k=document.createElement("div");k.className="promotion-title",k.textContent=P("chooseMove"),h.appendChild(k);const u=document.createElement("div");u.className="promotion-pieces",u.style.gap="20px";const d=document.createElement("div");d.className="promotion-choice",d.style.cssText="width:140px;height:110px;flex-direction:column;display:flex;justify-content:center;align-items:center;";const p=document.createElement("div");p.style.cssText="display:flex;gap:5px;";const v=document.createElement("div");v.className=`piece ${l?"piece-white":"piece-black"}`,v.textContent=M[s],v.style.fontSize="48px",p.appendChild(v),d.appendChild(p);const g=document.createElement("div");g.textContent=P("enPassant"),g.style.cssText="font-size:12px;margin-top:5px;color:white;",d.appendChild(g);const y=document.createElement("div");y.textContent=P("pawnCaptures"),y.style.cssText="font-size:10px;color:#64748b;",d.appendChild(y),d.onclick=()=>{document.getElementById("enPassantChoiceOverlay")?.remove(),Y(e,t,n,c,"en-passant")},u.appendChild(d);const m=document.createElement("div");m.className="promotion-choice",m.style.cssText="width:140px;height:110px;flex-direction:column;display:flex;justify-content:center;align-items:center;";const E=document.createElement("div");E.style.cssText="display:flex;gap:5px;";const x=document.createElement("div");x.className=`piece ${l?"piece-white":"piece-black"}`,x.textContent=M[r],x.style.fontSize="48px",E.appendChild(x),m.appendChild(E);const N=document.createElement("div");N.textContent=P("normalMove"),N.style.cssText="font-size:12px;margin-top:5px;color:white;",m.appendChild(N);const q=document.createElement("div");q.textContent=`(${j(r)} ${P("moves_")})`,q.style.cssText="font-size:10px;color:#64748b;",m.appendChild(q),m.onclick=()=>{document.getElementById("enPassantChoiceOverlay")?.remove(),Y(e,t,n,c,"normal")},u.appendChild(m),h.appendChild(u),i.appendChild(h),document.body.appendChild(i)}function Ee(e,t){if(xe())return;const n=L(),c=n[e][t],i=ae();if(i){const[o,a]=i,s=le().find(r=>r.row===e&&r.col===t);if(s){const r=s.type;r==="castle-k"||r==="castle-q"||r==="castle-k-klik"||r==="castle-q-klik"||r==="castle-k-unklik-klik"||r==="castle-q-unklik-klik"?F(o,a,e,t,r):r==="castle-k-choice"||r==="castle-q-choice"?Ye(o,a,e,t,r):r==="en-passant-choice"?Je(o,a,e,t):Y(o,a,e,t,r)}else if(c.pieces.length>0&&b(c.pieces[0])===(C()==="white")){ee([e,t]),te(null);const r=oe(n,e,t,c.pieces,z(),D(),G(),null);V(r)}else J()}else if(c.pieces.length>0){const o=b(c.pieces[0]);if(o&&C()==="white"||!o&&C()==="black"){ee([e,t]),te(null);const a=oe(n,e,t,c.pieces,z(),D(),G(),null);V(a)}}I(),K()}function Xe(e,t,n,c){if(xe())return;c.stopPropagation();const i=L(),o=i[e][t],a=o.pieces[n],l=b(a);if(l&&C()!=="white"||!l&&C()!=="black")return;if(ee([e,t]),te(n),$(a)==="k"){const d=Z(i,e,t,a,z(),D(),G()).map(p=>({row:p[0],col:p[1],type:"unklik"})).filter(p=>!U(i,e,t,p.row,p.col,o.pieces,"unklik",n));V(d),I(),K();return}const s=Z(i,e,t,a,z(),D(),G()),r=[],h=B(a);for(const u of s){const[d,p,v]=u,g=i[d][p];h&&(l&&d===7||!l&&d===0)||(v==="en-passant"?r.push({row:d,col:p,type:"en-passant-unklik"}):g.pieces.length===0||b(g.pieces[0])!==l?r.push({row:d,col:p,type:"unklik"}):g.pieces.length<2&&b(g.pieces[0])===l&&!g.pieces.some(m=>$(m)==="k")&&r.push({row:d,col:p,type:"unklik-klik"}))}const k=r.filter(u=>!U(i,e,t,u.row,u.col,o.pieces,u.type,n));V(k),I(),K()}function F(e,t,n,c,i){const o=L(),a=i.startsWith("castle-k"),l=a?7:0,s=a?5:3,r=o[e][t].pieces;S(n,c,r),S(e,t,[]);const h=[...o[e][l].pieces];S(e,l,[]);let k=`O-O${a?"":"-O"}`;if(i.includes("unklik-klik")){const d=h.find(g=>$(g)==="r"),p=h.find(g=>$(g)!=="r"),v=[...o[e][s].pieces];S(e,s,[d,...v]),S(e,l,[p]),k+=" (toren klikt)"}else if(i.includes("klik")&&!i.includes("unklik")){const d=[...o[e][s].pieces];S(e,s,[...h,...d]),k+=" klikt"}else if(i.includes("both"))S(e,s,h),k+=" (beide)";else if(h.length===2){const d=h.find(v=>$(v)==="r"),p=h.find(v=>$(v)!=="r");S(e,s,[d]),S(e,l,[p]),k+=" (alleen toren)"}else S(e,s,h);ie(C()),J();const u=C();re(),de({turn:u,notation:k}),I(),K(),ue()}function Y(e,t,n,c,i){const o=L(),a=o[e][t],l=o[n][c];let s,r="";me(null);const h=l.pieces.length>0,k=_(e,t),u=_(n,c),d=Pe();if(i==="unklik"||i==="unklik-klik"||i==="en-passant-unklik"){const m=a.pieces[d],E=a.pieces.filter((q,O)=>O!==d);if(s=[m],S(e,t,E),r=`${M[m]}${k}-${u}`,i==="en-passant-unklik"){const q=C()==="white"?n+1:n-1;S(q,c,[]),S(n,c,[m]),r+=` x${_(q,c)} e.p.`,A(e,t,n,c,s),Q(r);return}const x=B(m),N=b(m)&&n===0||!b(m)&&n===7;if(x&&N){if(i==="unklik-klik"?(S(n,c,[...l.pieces,m]),r+=" klikt"):l.pieces.length>0?(S(n,c,[m]),r+=" x"):S(n,c,[m]),fe()){const q=b(m)?"Q":"q",w=se(n,c).filter(W=>!B(W));w.unshift(q),S(n,c,w),r+="="+M[q],A(e,t,n,c,w),Q(r)}else{const q={row:n,col:c,isWhite:b(m),moveNotation:r,wasCapture:l.pieces.length>1||i!=="unklik-klik"&&l.pieces.length>0};ne(q),be()}return}i==="unklik-klik"?(S(n,c,[...l.pieces,m]),r+=" klikt"):(l.pieces.length>0&&(r=`${M[m]}${k}x${u}`),S(n,c,[m])),A(e,t,n,c,s)}else if(i==="en-passant"){s=[...a.pieces],S(e,t,[]);const m=C()==="white"?n+1:n-1;S(m,c,[]),S(n,c,s),r=`${R(s)}${k}x${_(m,c)} e.p.`}else{s=[...a.pieces],S(e,t,[]),r=`${R(s)}${k}-${u}`;const m=s.some(x=>B(x)),E=b(s[0])&&n===0||!b(s[0])&&n===7;if(m&&E){if(i==="klik"?(S(n,c,[...l.pieces,...s]),r+=" klikt"):(l.pieces.length>0&&(r+=" x"),S(n,c,s)),fe()){const x=b(s[0])?"Q":"q",q=se(n,c).filter(O=>!B(O));q.unshift(x),S(n,c,q),r+="="+M[x],A(e,t,n,c,q),Q(r)}else{const x={row:n,col:c,isWhite:b(s[0]),moveNotation:r,otherPieces:s.filter(N=>!B(N)),wasCapture:l.pieces.length>s.length};ne(x),be()}return}i==="klik"?(S(n,c,[...l.pieces,...s]),r+=" klikt"):(l.pieces.length>0&&(r=`${R(s)}${k}x${u}`),S(n,c,s)),A(e,t,n,c,s)}const p=s.some(m=>B(m)),v=t===c,g=b(s[0])&&e===6||!b(s[0])&&e===1;if(p&&v&&g&&!h&&Math.abs(e-n)===2){const m=(e+n)/2;me({row:m,col:c})}s.includes("K")?ie("white"):s.includes("k")&&ie("black");for(const m of s)B(m)&&De(m);Q(r)}function Q(e){J();const t=C();re(),de({turn:t,notation:e}),I(),K(),ue()}function qe(e){const t=Se();if(!t)return;const{row:n,col:c,moveNotation:i}=t,a=se(n,c).filter(h=>!B(h));a.unshift(e),S(n,c,a);const l=document.getElementById("promotionOverlay");l&&l.remove();const s=i+"="+M[e];J();const r=C();re(),de({turn:r,notation:s}),ne(null),I(),K(),ue()}function ue(){const e=L(),t=C(),n=Ue(e,t);_e(e,t,z(),D(),G())?n&&Fe():(ze(!0),n?ve("checkmate",t==="white"?"black":"white"):ve("stalemate",null))}function pe(){He(),I(),K()}function Re(){const e=document.getElementById("autoPromote");Ae(e.checked)}Ce();document.addEventListener("DOMContentLoaded",()=>{pe()});
